//////////////////////////////////////////////////////////////////////////	XHOST 리눅스용 BBS HOST 개발자 : 김성대  (대구:964-1002)////////////////////////////////////////////////////////////////////////#include "bbs.h"#include <dirent.h>    //디렉토리 화일명 변환함수때문에 필요char cid[30];char cname[30];int ntotal;int nyear;time_t cdate;char   TMP_FILE3[90] ; //FILE *fpin;main(argc, argv)int argc;char *argv[];{	char tid[20];	char tid2[20];	char tcode[20];	char tclub[20];	char filename[2000];	char buff[2000];	int mode;	findport(tty);	read_cfg();	set_tmpfile();	sprintf(TMP_FILE3,"tmp/tmp3%d%s",cfg.hostno,no_spc(tty));   //호스트번호별임시화일	set_nowmenu();	nyear=now_year();	if (argc<4) {	//root모드로 설정 그냥exec		printf(" 자료 자동 변환 기능\n");		printf(" txt2bbs <동호회> <가기코드> <작업자아이디>\n");		pressenter();		return;	}	if (atoi(argv[1])==2){		strcpy(tcode,argv[2]);		strcpy(tid	,argv[3]);	}	else {		strcpy(tclub,argv[1]);		strcpy(tcode,argv[2]);		strcpy(tid	,argv[3]);	}	if (!read_pf(tid)) {		printf("\n %s 회원이 없습니다.\n",tid);		pressenter();		return;	}	club_mode=find_club(tclub);	if (!find_go(tcode)) {		mess("%s 가기코드가 없습니다.",tcode);		pressenter();		return;	}	sprintf(NOW_FILE ,"%s/menu/%s.tit",club_go.dir,go.code);	strchng(NOW_FILED,NOW_FILE,".tit",".txt");	touch_file(NOW_FILE);touch_file(NOW_FILED);	if (!is_file(NOW_FILE)) {mess("자료를 올릴 %s 화일이 없습니다.",NOW_FILE);return;}	while (1) {		strcpy(cid,pf.id);		strcpy(cname,pf.nick);		if (nyear<100) nyear+=1900;		sys_tem("rm -rf tmp/up%d%s",cfg.hostno,no_spc(tty));		cls();		print_(1,"[%s] %s  (%d/%d Byte  %d Rec)",go.code,NOW_FILE,file_size(NOW_FILE),file_size(NOW_FILED),count_rec(NOW_FILE,sizeof_bbs));		printf("  1. _{{형식 TEXT 자동 등록 \n");        printf("  2. ;SN ;TI ;TX ;TF ;TU ;TD  자동 등록 \n");		printf("  6. 제목 <-> TEXT 일괄편집      \n");		printf(" 11. 하이텔       DN 갈무리             12. 하이텔 강좌  DN 갈무리\n");		printf(" 13. 하이텔뉴스   PR 갈무리             14. 하이텔자료실 PR 갈무리\n");		printf(" 15. 하이텔게시판 PR 갈무리    \n");		printf(" 21. 나우 DN 제  목:/올린이 :/읽음 :    22. DN제  목:/올린시각 :/읽음 :\n");		printf(" 23. 나우 DN 제  목:/올린이:/읽음:      24. DN제  목:/올린시각:/읽음:   \n");		printf(" 25. 나우 DN 제  목:/올린이:/작성:/추천 26. DN번  호:/게시자 :/등록일 :/제  목\n");		printf(" 27. 나우 PR 제  목/검색어/올린이       28. PR제  목/검색어/올린이\n");		printf(" 29. 나우누리뉴스 DN 갈무리             30. PR제  목 :검색어 :올린이 :관련자료\n");		printf(" 31. DN번  호:/게시자 :/등록일 :/제  목 32. DN제  목 :/올린이 :/읽음 :\n");		printf(" 41. 천리안 DN 갈무리등록               42. 천리안 NR 갈무리등록\n");		printf(" 51. 디렉토리지정    등록\n");		printf(" 81. 다른게시판파일  등록\n");		printf(" 91. 날짜지정:%s\n",rbit(cfg.txtmode,1,"게시물날짜","오늘"));		printf(" 92. 작업년도:%04d\n",nyear%10000);		printf(" 93. 파일 조합형->완성형 한글 변환후 작업:%s\n",rbit(cfg.txtmode,2,"무시","변환"));        printf(" 96. XFORMAT 파일 변환     97. 기타형식(XFORMAT) 파일 변환\n");		printf(" 98. 자료SORT              99. BDN\n");		printf(" 도움(H)  종료(P)  선택 >>");		lineinput(buff,3);check_han(buff);printf("\n");		mode=atoi(buff);			 if (is_same(buff,"h")) view("frm/txt2bbs/help.hlp");		else if (strlen(buff)==1&&is_char("QqPpxX0",buff[0])) break;		else if (is_same(buff,"xx")) break;		else if (mode==1)  txt_bbs();        else if (mode==2)  tx_format();		else if (mode==6)  edit_title();		else if (mode==11) hit_bbs();		else if (mode==12) hit_bbs2();		else if (mode==13) hin_bbs();		else if (mode==14) hid_bbs();		else if (mode==15) hip_bbs();		else if (mode==21) now_bbs(1);		else if (mode==22) now_bbs(2);		else if (mode==23) now_bbs(3);		else if (mode==24) now_bbs(4);		else if (mode==25) now_bbs(5);		else if (mode==26) now_bbs(6);		else if (mode==27) now_bbs(7);		else if (mode==28) now_bbs(8);		else if (mode==29) now_news();		else if (mode==30) now_bbs(9);		else if (mode==31) now_bbs(10);		else if (mode==32) now_bbs(11);		else if (mode==41) cho_bbs(filename);		else if (mode==42) cho_bbs_nr(filename);		else if (mode==51) dir_bbs(filename);		else if (mode==81) bbs_bbs();		else if (mode==91) cfg.txtmode=gtt_bit(cfg.txtmode,1);		else if (mode==92) {			printf("\n\n 기본설정연도 지정>>");			nyear=get_num(nyear,4);		}		else if (mode==93) cfg.txtmode=gtt_bit(cfg.txtmode,2);		else if (mode==96) xformat();		else if (mode==97) conv_bbs();		else if (mode==98) sys_tem("bin/bsysop '%s' '%s' '%s' 101",go.code,club_go.code,pf.id);		else if (mode==99) sys_tem("bin/bdn '%s' '%s' '%s' 101",go.code,club_go.code,pf.id);		if (bit(cfg.txtmode,2)) unlink(TMP_FILE3);	}}dir_bbs(){	char dir[2000];	char buff[500];	char filename[300];	char bbs_title[60];	DIR *dp;	struct dirent *dfp;	if (pf.type<18) {		mess("이 메뉴는 등급 18이상만 사용 가능합니다.");		return ;	}	printf("\n");	printf (" 일괄 등록할 게시물화일이 있는 디렉토리는? (취소:Q) \n >>");	lineinput(dir,70);	printf("\n");	if (dir[0]==0) strcpy(dir,"/");	if (is_same(dir,"q")||is_same(dir,"p")) return;	printf(" 화일의 목록 bbs*\n");	printfL2();	sprintf(buff,"ls %s",dir);sys_tem(buff);	printfL2();	if (yesno(" 현재 이 자료로 게시판 변환을 시작할까요? (Y/n)",Yes)==No) return;	printf("\n");	printf (" 일괄 등록할 게시물 제목은? (취소:Q) \n >>");	lineinput(bbs_title,60);	printf("\n");	if (bbs_title[0]==0 ||is_same(bbs_title,"q")||is_same(bbs_title,"p")) return;	//디렉토리에서 bbs*을 읽어낸다.	dp= opendir(dir);	while((dfp=readdir(dp)) != NULL) {		if(stristr(dfp->d_name,"..")) continue;		sprintf(filename,"%s/%s",dir,dfp->d_name);		if (file_size(filename)<1) continue;		if (is_dir(filename))	   continue;		unlink(TMP_FILE);		strcpy(bbs.title,"");		bbs.del=0;		bbs.read=0;		bbs.down=0;		bbs.gd=' ';		bbs.line=0;		strcpy(bbs.id,pf.id);		strcpy(bbs.name,pf.name);		sprintf(buff,"%s %s",bbs_title,dfp->d_name);		buff[60]=0;		strcpy(bbs.title,buff);		sprintf(buff,"cp %s %s",filename,TMP_FILE);sys_tem(buff);		bbs_save_add2(0);	}	closedir(dp);}txt_bbs(){	FILE *fp1,*fp2;	char buff[2000];	char buff1[2000];	char ch,ch1,ch2,ch3,ch4;	char filename[300];	int fp2open=No;	int found=No;	int i;	char tNOW_FILE[300];	char tNOW_FILED[300];	strcpy(tNOW_FILE,NOW_FILE);strcpy(tNOW_FILED,NOW_FILED);	fp1=NULL;	fp2=NULL;	//화일을 전송받아 filename에 저장한다.	view("frm/txt2bbs/textup.log");    if (!up_file(0,filename,No)) return;	if ((fpin=fopen(filename,"r"))==NULL) return;	ntotal=file_size(filename);	unlink(TMP_FILE);	fp2=fopen(TMP_FILE,"w");	fp2open=Yes;	printf("\n %s(%s) 에 추가되는 자료\n",go.code,go.name);	printf(" 파일명:%s   (%d byte)\n",filename,file_size(filename));	printfL2();	strcpy(bbs.title,"");	bbs.del=0;	bbs.read=0;	bbs.down=0;	bbs.gd=' ';	bbs.line=0;	strcpy(cid,pf.id);	strcpy(cname,pf.nick);//_{{}hello 	  //다른가기코드//_{{{Mr.2//_{{[mr2.jpg//남(듀엣) 가수	while(1) {		strcpy(buff,"");		bzero(buff,2000);		bzero(buff1,2000);		if (get_line(buff1)==No) break;  //1줄 입력		xstrncpy(buff,buff1,6);		if (stristr(buff,"_{{}")) {			found=Yes;			if (fp2!=NULL) fclose(fp2);			bbs_save_add2(0);			strcpy(buff,&buff1[4]);xstrncpy(buff1,buff,8);			del_enter(buff);del_space(buff);del_esc3(buff);			strcat(buff1,".t");del_space(buff1);del_esc3(buff1);			strcpy(buff,NOW_FILE);			strchng8(buff,"menu/");			strchng2(buff,".tit",".t");			strchng2(NOW_FILE,buff,buff1);			strchng2(NOW_FILED,buff,buff1);		}		else if (stristr(buff,"_{{{")) {			found=Yes;			if (fp2!=NULL) fclose(fp2);			bbs_save_add2(0);			fp2=fopen(TMP_FILE,"w");			strcpy(bbs.title,"");			strcpy(bbs.filename,"");			sprintf(bbs.key,"");			bbs.filesize=0;			time(&bbs.date);			strcpy(buff,&buff1[4]);			del_enter(buff);all_trim(buff);del_esc(buff);			xstrncpy(bbs.title,buff,60);		}		else if (stristr(buff,"_{{[")) {			//화일명의 나머지 입력			strcpy(buff,&buff1[4]);			del_enter(buff);all_trim(buff);del_esc(buff);			del_esc3(buff);strlwr(buff); //소문자로 등록			xstrncpy(bbs.filename,buff,12);			sprintf(buff,"%s/%s",go.dir,bbs.filename);			bbs.filesize=file_size(buff);		}		else if (is_same(buff,"_{{]")) {			//ID,이름 지정	 _{{]아이디 이름 키워드			strcpy(buff,&buff1[4]);			check_cmd(buff);			xstrncpy(cid,mmc[0],8);			xstrncpy(cname,mmc[1],8);			del_space(cid);			del_space(cname);		}		else {	//아니면 저장함			if (fp2==NULL) fp2=fopen(TMP_FILE,"w");			fprintf(fp2,"%s\n",buff1);		}	}	if (fpin!=NULL) fclose(fpin);	if (fp2!=NULL) fclose(fp2);	bbs_save_add2(0);	printfL2();	mess("게시판 자동등록이 모두 끝났습니다.");}tx_format(){	FILE *fp1,*fp2;    char buff[4000];    char buff1[4000];	char ch,ch1,ch2,ch3,ch4;	char filename[300];    int fp2open=No,new_file;	int found=No;	int i;    int text_mode=No;	char tNOW_FILE[300];	char tNOW_FILED[300];	strcpy(tNOW_FILE,NOW_FILE);strcpy(tNOW_FILED,NOW_FILED);	fp1=NULL;	//화일을 전송받아 filename에 저장한다.	view("frm/txt2bbs/textup.log");    if (!up_file(0,filename,No)) return;	if ((fpin=fopen(filename,"r"))==NULL) return;	ntotal=file_size(filename);	unlink(TMP_FILE);	fp2open=Yes;	printf("\n %s(%s) 에 추가되는 자료\n",go.code,go.name);	printf(" 파일명:%s   (%d byte)\n",filename,file_size(filename));	printfL2();	strcpy(bbs.title,"");	bbs.del=0;	bbs.read=0;	bbs.down=0;	bbs.gd=' ';	bbs.line=0;	strcpy(cid,pf.id);	strcpy(cname,pf.nick);    strcpy(bbs.title,"");	while(1) {		strcpy(buff,"");		bzero(buff,2000);		bzero(buff1,2000);		if (get_line(buff1)==No) break;  //1줄 입력        xstrncpy(buff,buff1,3);        buff1[1999]=0;        if (is_same(buff,";SN")||is_same(buff,";SZ")||is_same(buff,";TI")||is_same(buff,";EN")) {            text_mode=No;            new_file=is_same(buff,";SZ");			found=Yes;            if (strlen(bbs.title)>0) bbs_save_add2(0);            strcpy(bbs.title,"");            if (is_same(buff,";EN")) continue;            else if (is_same(buff,";TI")) {                //화일명의 나머지 입력                xstrncpy(buff,&buff1[3],100);                buff[60]=0;                del_enter(buff);all_trim(buff);del_esc(buff);                xstrncpy(bbs.title,buff,60);            }            else if (is_same(buff,";SN")) {                strcpy(bbs.title,"");                xstrncpy(buff,&buff1[3],30);                xstrncpy(buff1,buff,8);                del_enter(buff);del_space(buff);del_esc3(buff);                strchng2(buff,".","");strchng2(buff,"/","");                if (strlen(buff)>0) {                    if (club_mode) {                        sprintf(NOW_FILE ,"%s/menu/%s.tit",club_go.dir,buff);                        sprintf(NOW_FILED,"%s/menu/%s.txt",club_go.dir,buff);                    }                    else {                        sprintf(NOW_FILE ,"menu/%s.tit",buff);                        sprintf(NOW_FILED,"menu/%s.txt",buff);                    }                    if (new_file) {unlink(NOW_FILE);unlink(NOW_FILED);}                }            }		}        else if (is_same(buff,";TF")) {			//화일명의 나머지 입력            strcpy(buff,&buff1[3]);			del_enter(buff);all_trim(buff);del_esc(buff);			del_esc3(buff);strlwr(buff); //소문자로 등록			xstrncpy(bbs.filename,buff,12);			sprintf(buff,"%s/%s",go.dir,bbs.filename);			bbs.filesize=file_size(buff);		}        else if (is_same(buff,";TU")) {            strcpy(buff,&buff1[3]);            del_space(buff);xstrncpy(cid,buff,8);			del_space(cid);		}        else if (is_same(buff,";TN")) {            strcpy(buff,&buff1[3]);            del_space(buff);xstrncpy(cname,buff,8);			del_space(cname);		}        else if (is_same(buff,";TX")) {			unlink(TMP_FILE);            text_mode=Yes;        }        else if (text_mode) {            put_line3(buff1,TMP_FILE);		}	}	if (fpin!=NULL) fclose(fpin);	printfL2();	mess("게시판 자동등록이 모두 끝났습니다.");    strcpy(NOW_FILE,tNOW_FILE);strcpy(NOW_FILED,tNOW_FILED);}//#1798   배승철   (건빵맨	)//질문]퍼미션에 대한 궁금증입니다			  1998-12-13 11:16	 16 line//안녕하세요 ?//BBS를 만들때 퍼미션문제에 대해서 조금 이상한 생각이 들어서 글을 올립hit_bbs(){	FILE *fp1,*fp2;	char buff[2000];	char buff1[2000];	char buff2[2000];	char buff3[202];	char buff4[202];	char filename[302];	char ch,ch1,ch2,ch3;	int fp2open=No;	int found=No;	int i,i2;	//화일을 전송받아 filename에 저장한다.	view("frm/txt2bbs/hit_up1.log");	_cont1:	if (!up_file(0,filename,No)) goto _fail;	if (bit(cfg.txtmode,2)) {						//조합형모드		if (!jo2ks(filename,TMP_FILE3)) goto _fail;		strcpy(filename,TMP_FILE3);	}	if ((fpin=fopen(filename,"r"))==NULL) goto _fail;	unlink(TMP_FILE);	ntotal=file_size(filename);	fp2=fopen(TMP_FILE,"w");	fp2open=Yes;	printf("\n %s(%s) 에 추가되는 자료\n",go.code,go.name);	printf(" 파일명:%s   (%d byte)\n",filename,file_size(filename));	printfL2();	strcpy(bbs.title,"");	strcpy(cid,pf.id);	strcpy(cname,pf.nick);	bbs.del=0;	bbs.read=0;	bbs.down=0;	bbs.gd=' ';	bbs.line=0;	while(1) {		strcpy(buff1,"");		bzero(buff,510);		bzero(buff1,510);		bzero(buff2,510);		bzero(buff3,200);		if (get_line(buff1)==No) break;  //1줄 입력		i=strlen(buff1);		if(i>10&&buff1[0]=='#'&&buff1[i-1]==')'&&buff1[i-10]=='(') {			if (get_line(buff2)==No) break;  //2번째 줄 읽음			i=strlen(buff2);			if(i>22&&buff2[i-1]=='e'   //마지막이 line 이면				   &&buff2[i-2]=='n'				   &&buff2[i-3]=='i'				   &&buff2[i-4]=='l') {				found=Yes;				if (fp2!=NULL) fclose(fp2);				bbs_save_add2(0);				fp2=fopen(TMP_FILE,"w");				check_cmd(buff1);				sprintf(bbs.key,mmc[0]);				strcpy(cname,mmc[1]);				xstrncpy(cid  ,&buff1[strlen(buff1)-10],10);				strcpy(bbs.title,"");				strcpy(bbs.filename,"");				bbs.filesize=0;				if (!bit(cfg.txtmode,1)) {					xstrncpy(buff,&buff2[44],18);					all_trim(buff);					bbs.date=str2date2(buff);				}				xstrncpy(bbs.title,buff2,44);				all_trim(bbs.title);			}			else {	//아니면 저장함				fprintf(fp2,"%s\n",buff1);				fprintf(fp2,"%s\n",buff2);			}		}		else {			fprintf(fp2,"%s\n",buff1);		}	}	if (fpin!=NULL) fclose(fpin);	if (fp2!=NULL) fclose(fp2);	bbs_save_add2(0);	printfL2();	if (!found) goto _fail;	mess("게시판 자동등록이 모두 끝났습니다.");	unlink(TMP_FILE);	goto _cont1;	return;	_fail:	unlink(TMP_FILE);}//번  호 : 94//게시자 : 이선중	(HLFTO	 )//등록일 : 1995-08-23 09:11//제  목 : [갈무리] 엑스윈도에서 메모리 절약hit_bbs2(){	char buff[2000];	char buff1[2000];	char buff2[2000];	char buff3[2000];	char buff4[2000];	char filename[2000];	char ch,ch1,ch2,ch3;	FILE *fp1;	FILE *fp2;	int fp2open=No;	int found=No;	int i,n,n1,n2,n3;	//화일을 전송받아 filename에 저장한다.	view("frm/txt2bbs/hit_up2.log");	_cont1:	if (!up_file(0,filename,No)) return;	if (bit(cfg.txtmode,2)) {						//조합형모드		if (!jo2ks(filename,TMP_FILE3)) goto _fail;		strcpy(filename,TMP_FILE3);	}	if ((fpin=fopen(filename,"r"))==NULL) return;	ntotal=file_size(filename);	unlink(TMP_FILE);	fp2=fopen(TMP_FILE,"w");	fp2open=Yes;	printf("\n %s(%s) 에 추가되는 자료\n",go.code,go.name);	printf(" 파일명:%s   (%d byte)\n",filename,file_size(filename));	printfL2();	strcpy(bbs.title,"");	bbs.del=0;	bbs.read=0;	bbs.down=0;	bbs.gd=' ';	bbs.line=0;	strcpy(cid,pf.id);	strcpy(cname,pf.nick);//번  호 : 94//게시자 : 이선중	(HLFTO	 )//등록일 : 1995-08-23 09:11//제  목 : [갈무리] 엑스윈도에서 메모리 절약	while(1) {		strcpy(buff,"");		bzero(buff,510);		bzero(buff2,510);		bzero(buff3,200);		bzero(buff4,200);//		  printf("%s",buff1);pressenter();		if (get_line(buff1)==No) break;  //1줄 입력		if (stristr(buff1,"번  호 : ")) {			if (get_line(buff2)==No) break;  //2번째 줄 읽음			if (stristr(buff2,"게시자 : ")) {				if (get_line(buff3)==No) break;  //3번째 줄 읽음				if (stristr(buff3,"등록일 : ")) {					if (get_line(buff4)==No) break;  //4번째 줄 읽음					if (stristr(buff4,"제  목 : ")) {						found=Yes;						if (fp2!=NULL) fclose(fp2);						bbs_save_add2(0);						fp2=fopen(TMP_FILE,"w");						strcpy(bbs.title,"");						strcpy(bbs.filename,"");						sprintf(bbs.key,"");						bbs.filesize=0;						xstrncpy(cname,&buff2[9],8);						strcpy(cid	,&buff2[18]);						strchng2(cid,"(","");strchng2(cid,")","");all_trim(cid);						if (!bit(cfg.txtmode,1)) {							strcpy(buff,&buff3[9]);							bbs.date=str2date2(buff);						}						strcpy(buff,&buff4[9]);						all_trim(buff); 		   //제목으로 지정						xstrncpy(bbs.title,buff,60);					}					else {	//아니면 저장함						if (fp2==NULL) fp2=fopen(TMP_FILE,"w");						fprintf(fp2,"%s\n",buff1);						fprintf(fp2,"%s\n",buff2);						fprintf(fp2,"%s\n",buff3);						fprintf(fp2,"%s\n",buff4);					}				}				else {	//아니면 저장함					if (fp2==NULL) fp2=fopen(TMP_FILE,"w");					fprintf(fp2,"%s\n",buff1);					fprintf(fp2,"%s\n",buff2);					fprintf(fp2,"%s\n",buff3);				}			}			else {	//아니면 저장함				if (fp2==NULL) fp2=fopen(TMP_FILE,"w");				fprintf(fp2,"%s\n",buff1);				fprintf(fp2,"%s\n",buff2);			}		}		else {	//아니면 저장함			if (fp2==NULL) fp2=fopen(TMP_FILE,"w");			fprintf(fp2,"%s\n",buff1);		}	}	if (fpin!=NULL) fclose(fpin);	if (fp2!=NULL) fclose(fp2);	bbs_save_add2(0);	printfL2();	if (!found) goto _fail;	mess("게시판 자동등록이 모두 끝났습니다.");	unlink(TMP_FILE);	goto _cont1;	return;	_fail:	unlink(TMP_FILE);}hin_bbs(){	char buff[2000];	char buff2[2000];	char buff3[2000];	char buff4[2000];	char filename[2000];	char ch,ch1,ch2,ch3;	FILE *fp1;	FILE *fp2;	int fp2open=No;	int found=No;	int i,n,n1,n2,n3;	int tail=No;	//화일을 전송받아 filename에 저장한다.	view("frm/txt2bbs/hit_up1.log");	_cont1:	if (!up_file(0,filename,No)) return;	if (bit(cfg.txtmode,2)) {						//조합형모드		if (!jo2ks(filename,TMP_FILE3)) goto _fail;		strcpy(filename,TMP_FILE3);	}	if ((fpin=fopen(filename,"r"))==NULL) return;	ntotal=file_size(filename);	unlink(TMP_FILE);	fp2=fopen(TMP_FILE,"w");	fp2open=Yes;	printf("\n %s(%s) 에 추가되는 자료\n",go.code,go.name);	printf(" 파일명:%s   (%d byte)\n",filename,file_size(filename));	printfL2();	strcpy(bbs.title,"");	bbs.del=0;	bbs.read=0;	bbs.down=0;	bbs.gd=' ';	bbs.line=0;	strcpy(cid,pf.id);	strcpy(cname,pf.nick);	while(1) {// 일  시 : 19981228  204451// 제  목 : [이회창총재] 반도체 빅딜 백지화 요구// 일  시 : 970506	091432// 제  목 : [알림] 대만 컴퓨텍스97 시찰단 모집//	전자신문사는  오는 6월 대만세계무역센터(TWTC)에서 개최되는 대만 최대의		strcpy(buff,"");		bzero(buff,510);		bzero(buff2,510);		bzero(buff3,200);		if (get_line(buff)==No) break;	//1줄 입력		if (stristr(buff,"일  시 : ")) {			if (get_line(buff2)==No) break;  //2번째 줄 읽음			if (stristr(buff2,"제  목 : ")) {				found=Yes;				tail=No;					  //내용끝 쓰레기값				if (fp2!=NULL) fclose(fp2);				bbs_save_add2(0);				fp2=fopen(TMP_FILE,"w");				strcpy(bbs.title,"");				strcpy(bbs.filename,"");				bbs.filesize=0;				strcpy(cid,pf.id);				strcpy(cname,pf.name);				if (!bit(cfg.txtmode,1)) {					strchng2(buff,"일  시 :","");					del_space(buff);					bbs.date=str2date4(buff);					xstrncpy(cid,datestr(5,bbs.date),8);					xstrncpy(cname,datestr(32,bbs.date),8);				}				sprintf(bbs.key,"");				strchng2(buff2,"제  목 :","");				all_trim(buff2);			//제목으로 지정				xstrncpy(bbs.title,buff2,60);			}			else {	//아니면 저장함				if (fp2==NULL) fp2=fopen(TMP_FILE,"w");				fprintf(fp2,"%s\n",buff);				fprintf(fp2,"%s\n",buff2);			}		}		else if (stristr(buff," ============   종  료   ========")) tail=Yes;		else {			if (fp2==NULL) fp2=fopen(TMP_FILE,"w");			if (!tail) fprintf(fp2,"%s\n",buff);		}	}	if (fpin!=NULL) fclose(fpin);	if (fp2!=NULL) fclose(fp2);	bbs_save_add2(0);	printfL2();	if (!found) goto _fail;	mess("게시판 자동등록이 모두 끝났습니다.");	unlink(TMP_FILE);	goto _cont1;	return;	_fail:	unlink(TMP_FILE);}hid_bbs(){	char buff[2000];	char buff1[2000];	char buff2[2000];	char buff3[2000];	char buff4[2000];	char buff5[2000];	char filename[2000];	char t1[30];	char t2[30];	char txt_mode=No;	FILE *fp1;	FILE *fp2;	int found=No;	int i;	fp1=fp2=NULL;	//화일을 전송받아 filename에 저장한다.	view("frm/txt2bbs/hid_up1.log");	_cont1:	if (!up_file(0,filename,No)) goto _fail;	if (bit(cfg.txtmode,2)) {						//조합형모드		if (!jo2ks(filename,TMP_FILE3)) goto _fail;		strcpy(filename,TMP_FILE3);	}	if ((fpin=fopen(filename,"r"))==NULL) goto _fail;	ntotal=file_size(filename);	unlink(TMP_FILE);	fp2=fopen(TMP_FILE,"w");	printf("\n %s(%s) 에 추가되는 자료\n",go.code,go.name);	printf(" 파일명:%s   (%d byte)\n",filename,file_size(filename));	printfL2();	strcpy(bbs.title,"");	strcpy(cid,pf.id);	strcpy(cname,pf.nick);	bbs.del=0;	bbs.read=0;	bbs.down=0;	bbs.gd=' ';	bbs.line=0;/* 계속하겠습니까?(Y/n) y HiTEL───────────────────────────────────── PBRI							 전체자료							  1477/1482━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 제  목:[XHOST]4.X 에서 5.X로 변환				 분류:COMM	   전송:4	   1/ 1 파일명:conv501.tgz  크기:61908    UP:1998-12-11 DN:1998-12-20 등록자:rhskyuXHOST 4.X 에서 5.X 로 변환해주는프로그램입니다.*/	while(1) {		strcpy(buff1,"");		bzero(buff1,510);		bzero(buff2,510);		bzero(buff3,510);		bzero(buff4,510);		bzero(buff5,510);		if (get_line(buff1)==No) break;  //1줄 입력		if (stristr(buff1,"계속하겠습니까?(Y/n)")) continue;		if (stristr(buff1,"계속하시겠습니까? (Y/n)")) continue;		i=strlen(buff1);		if(i>60&&stristr(buff1,"hitel")&&stristr(buff1,"────────")) {			if (get_line(buff2)==No) break;  //2번째 줄 읽음			if (strlen(buff2)>40) {				if (get_line(buff3)==No) break;  //3번째 줄 읽음				if (strlen(buff3)>40) {					if (get_line(buff4)==No) break;  //3번째 줄 읽음					if (strlen(buff4)>40&&stristr(buff4,"제  목:")&&stristr(buff4,"분류:")&&stristr(buff4,"전송:")) {						if (get_line(buff5)==No) break;  //3번째 줄 읽음						if (strlen(buff5)>40&&							stristr(buff5,"파일명:")&&							stristr(buff5,"크기:")&&							stristr(buff5,"등록자:")) {							found=Yes;							if (fp2!=NULL) fclose(fp2);							bbs_save_add2(0);							txt_mode=Yes;							fp2=fopen(TMP_FILE,"w");							//아이디 지정							strcpy(buff,buff5);							strchng8(buff,"등록자:");							strchng2(buff,"등록자:","");							all_trim(buff);							xstrncpy(cname,buff,8);							xstrncpy(cid,buff,8);							//제목 지정							xstrncpy(buff,&buff4[8],60);							strchng9(buff,"분류:");							all_trim(buff);							xstrncpy(bbs.title,buff,60);							//분류 지정							xstrncpy(buff,&buff4[48],60);							strchng8(buff,"분류:");							strchng9(buff,"전송:");							strchng2(buff,"분류:","");							all_trim(buff);							xstrncpy(bbs.key,buff,8);							//파일명							xstrncpy(buff,&buff5[8],50);							strchng9(buff,"크기:");							all_trim(buff);							xstrncpy(bbs.filename,buff,12);							del_esc3(bbs.filename);							//등록날짜							if (!bit(cfg.txtmode,1)) {								xstrncpy(buff,&buff5[34],60);								strchng8(buff,"UP:");								strchng9(buff,"DN:");								strchng2(buff,"UP:","");								all_trim(buff);								bbs.date=str2date2(buff);							}							bbs.read=0;							bbs.down=0;							bbs.ok=0;							sprintf(buff,"%s/%s",go.dir,bbs.filename);							bbs.filesize=file_size(buff);						}						else if (txt_mode) {							if (fp2==NULL) fp2=fopen(TMP_FILE,"w");							fprintf(fp2,"%s\n",buff1);							fprintf(fp2,"%s\n",buff2);							fprintf(fp2,"%s\n",buff3);							fprintf(fp2,"%s\n",buff4);							fprintf(fp2,"%s\n",buff5);						}					}					else if (txt_mode) {						if (fp2==NULL) fp2=fopen(TMP_FILE,"w");						fprintf(fp2,"%s\n",buff1);						fprintf(fp2,"%s\n",buff2);						fprintf(fp2,"%s\n",buff3);						fprintf(fp2,"%s\n",buff4);					}				}				else if (txt_mode) {					if (fp2==NULL) fp2=fopen(TMP_FILE,"w");					fprintf(fp2,"%s\n",buff1);					fprintf(fp2,"%s\n",buff2);					fprintf(fp2,"%s\n",buff3);				}			}			else if (txt_mode) {				if (fp2==NULL) fp2=fopen(TMP_FILE,"w");				fprintf(fp2,"%s\n",buff1);				fprintf(fp2,"%s\n",buff2);			}		}		else if (stristr(buff1,"계속하겠습니까?(Y/n)")) txt_mode=No;		else if (stristr(buff1,"계속하시겠습니까? (Y/n)")) txt_mode=No;		else if (stristr(buff1,"계속하시겠습니까? (Y/n)")) txt_mode=No;		else if (stristr(buff1,"*** 출력종료 ***")) txt_mode=No;		else if (stristr(buff1,"  번호 ID       파일명        크기 전송 제  목")) txt_mode=No;		else if (txt_mode) {			if (fp2==NULL) fp2=fopen(TMP_FILE,"w");			fprintf(fp2,"%s\n",buff1);		}	}	if (fp1!=NULL) fclose(fp1);	if (fp2!=NULL) fclose(fp2);	bbs_save_add2(0);	printfL2();	if (!found) goto _fail;	mess("게시판 자동등록이 모두 끝났습니다.");	goto _cont1;	return;	_fail:}hip_bbs(){	char buff[2000];	char buff1[2000];	char buff2[2000];	char buff3[2000];	char buff4[2000];	char buff5[2000];	char filename[2000];	char t1[30];	char t2[30];	FILE *fp1;	FILE *fp2;	int found=No;	int i;	int tail=No;	fp1=fp2=NULL;	//화일을 전송받아 filename에 저장한다.	view("frm/txt2bbs/hip_up1.log");	_cont1:	if (!up_file(0,filename,No)) goto _fail;	if (bit(cfg.txtmode,2)) {						//조합형모드		if (!jo2ks(filename,TMP_FILE3)) goto _fail;		strcpy(filename,TMP_FILE3);	}	if ((fpin=fopen(filename,"r"))==NULL) goto _fail;	ntotal=file_size(filename);	unlink(TMP_FILE);	fp2=fopen(TMP_FILE,"w");	printf("\n %s(%s) 에 추가되는 자료\n",go.code,go.name);	printf(" 파일명:%s   (%d byte)\n",filename,file_size(filename));	printfL2();	strcpy(bbs.title,"");	strcpy(cid,pf.id);	strcpy(cname,pf.nick);	bbs.del=0;	bbs.read=0;	bbs.down=0;	bbs.gd=' ';	bbs.line=0;/* 김성대   (kumkangs)xhost] 메뉴얼 제작해주실분 없으신가요?		1997-05-07 01:08   28 lineXHOST 4.X 에서 5.X 로 변환해주는*/	while(1) {		strcpy(buff1,"");		bzero(buff1,510);		bzero(buff2,510);		bzero(buff3,510);		bzero(buff4,510);		bzero(buff5,510);		if (get_line(buff1)==No) break;  //1줄 입력		if (stristr(buff1,"계속하겠습니까?(Y/n)")) continue;		if (stristr(buff1,"계속하시겠습니까? (Y/n)")) continue;		if (strlen(buff1)<22&&			buff1[0 ]==' '&&buff1[ 9]==' '&&			buff1[10]=='('&&buff1[19]==')') {			if (get_line(buff2)==No) break;  //2번째 줄 읽음			if (stristr(buff2,"계속하겠습니까?(Y/n)")) continue;			if (stristr(buff2,"계속하시겠습니까? (Y/n)")) continue;			if (strlen(buff2)>60&&				buff2[44]==' '&&buff2[49]=='-'&&buff2[52]=='-'&&buff2[55]==' '&&buff2[58]==':'&&				buff2[61]==' '&&stristr(&buff2[65],"line")) {				found=Yes;				if (fp2!=NULL) fclose(fp2);				bbs_save_add2(0);				tail=No;					  //내용끝 쓰레기값				fp2=fopen(TMP_FILE,"w");				//아이디 지정				xstrncpy(cname,&buff1[ 1],8);				xstrncpy(cid  ,&buff1[11],8);				xstrncpy(bbs.title,buff2,44);				//등록날짜				if (!bit(cfg.txtmode,1)) {					xstrncpy(buff,&buff2[45],16);					all_trim(buff);					bbs.date=str2date2(buff);				}			}			else {				if (fp2==NULL) fp2=fopen(TMP_FILE,"w");				fprintf(fp2,"%s\n",buff1);				fprintf(fp2,"%s\n",buff2);			}		}		else if (stristr(buff1,"PRINTER/CAPTURE를 OFF 하시고  [ENTER] 를 누르십시오.")) tail=Yes;		else if (stristr(buff1,"PRINTER/CAPTURE를 준비하시고  [ENTER] 를 누르십시오.")) tail=No;		else if (stristr(buff1,"계속하겠습니까?(Y/n)"));		else if (stristr(buff1,"계속하시겠습니까? (Y/n)"));		else {			if (fp2==NULL) fp2=fopen(TMP_FILE,"w");			if (!tail) fprintf(fp2,"%s\n",buff1);		}	}	if (fp1!=NULL) fclose(fp1);	if (fp2!=NULL) fclose(fp2);	bbs_save_add2(0);	printfL2();	if (!found) goto _fail;	mess("게시판 자동등록이 모두 끝났습니다.");	goto _cont1;	return;	_fail:}cho_bbs(){	char dir[2000];	char buff[2000];	char buff1[2000];	char filename[2000];	DIR *dp;	struct dirent *dfp;	if (pf.type<18) {		mess("이 메뉴는 등급 18이상만 사용 가능합니다.");		return ;	}	printf (" 천리안갈무리 다운화일이 있는 디렉토리는? (취소:Q) \n >>");	lineinput(dir,70);	printf("\n");	if (dir[0]==0) strcpy(dir,"/");	if (is_same(dir,"q")||is_same(dir,"p")) return;	printf(" 화일의 목록 bbs*\n");	printfL2();	sprintf(buff,"ls %s/bbs*",dir);sys_tem(buff);	printfL2();	if (yesno(" 현재 이 자료로 게시판 변환을 시작할까요? (Y/n)",Yes)==No) return;	//디렉토리에서 bbs*을 읽어낸다.	dp= opendir(dir);	while((dfp=readdir(dp)) != NULL) {		if(stristr(dfp->d_name,"bbs")&&!stristr(dfp->d_name,".")) {			sprintf(filename,"%s/%s",dir,dfp->d_name);			if (!is_file(filename)) continue;  //화일없을때			cho_bbs2(filename);  //file을 NOW_FILE에 추가한다.		}	}	closedir(dp);}cho_bbs2(char *filename){	char buff[2000];	char buff1[2000];	char buff2[2000];	char buff3[2000];	char ch,ch1,ch2,ch3;	FILE *fp1;	FILE *fp2;	int fp2open=No;	int found=No;	int i,i2,start;	if ((fpin=fopen(filename,"r+"))==NULL) return;	ntotal=file_size(filename);	unlink(TMP_FILE);	fp2open=Yes;	strcpy(bbs.title,"");	bbs.del=0;	bbs.read=0;	bbs.down=0;	bbs.gd=' ';	bbs.line=0;	if (!get_line(buff1)||strlen(buff1)<10) {fclose(fpin);return;}	if (!get_line(buff2)||strlen(buff2)<10) {fclose(fpin);return;}	if (!stristr(buff1,"번호:")||!stristr(buff2,"제 목 :")) {fclose(fpin);return;}	//아이디 찾기	start=0;	strcpy(buff,"");	i2=0;	for (i=0;i<45;i++) {		if (!start&&buff1[i]==' ') start=1;		else if (start&&buff1[i]==' ') break;		else if (start) buff[i2++]=buff1[i];	}	buff[i2]=0;	strchng(buff3,buff,"등록자:","");	buff3[8]=0;del_space(buff3);del_esc(buff3);	strcpy(cid	,buff3);	strcpy(cname,buff3);	printf(buff);printf(cid);getchar();	//키 찾기	strcpy(buff,"");	i2=0;	for (i=0;i<35;i++) {		if (buff1[i]=='/') break;		else buff[i2++]=buff1[i];	}	buff[i2]=0;	strchng(buff3,buff,"번호:","");	del_space(buff3);del_esc(buff3);buff3[7]=0;	sprintf(bbs.key,"`%7.7s",buff3);	buff2[80]=0;	//제 목 : [공모] '푸른별 지구' 과거편 시나리오  ->제목 짜름	for(i=0;i<7;i++) buff2[i]=' ';	alltrim(buff,buff2);  //제목으로 지정	buff[60]=0;	strcpy(bbs.title,buff);	unlink(TMP_FILE);	fp2=fopen(TMP_FILE,"w");	while (get_line(buff)) fputs(buff,fp2);	if (fp2!=NULL) fclose(fp2);	bbs_save_add2(0);	fclose(fpin);}cho_bbs_nr(char *filename){	char buff[2000];	char buff1[2000];	char buff2[2000];	char buff3[2000];	char buff4[2000];	char t1[30];	char t2[30];	FILE *fp1;	FILE *fp2;	int found=No;	int i;	if ((fpin=fopen(filename,"r+"))==NULL) return;	ntotal=file_size(filename);	unlink(TMP_FILE);	fp2=fopen(TMP_FILE,"w");	printf("\n %s(%s) 에 추가되는 자료\n",go.code,go.name);	printfL2();	strcpy(bbs.title,"");	strcpy(cid,pf.id);	strcpy(cname,pf.nick);	bbs.del=0;	bbs.read=0;	bbs.down=0;	bbs.gd=' ';	bbs.line=0;//// [번	호] 1 / 444 		 [등록일] 96년 03월 09일 02:33		Page : 1 / 4// [등록자] KONG09// [제	목] [강좌] 웹을 그리자 -> 웹 이해하기//───────────────────────────────────────//// [번	호] 6 / 444 		 [등록일] 96년 03월 09일 02:36		Page : 1 / 7// [등록자] KONG09// [제	목] [강좌] 웹을 그리자 #6 -> 웹 이해하기//───────────────────────────────────────////// [번	호] 51 / 444		 [등록일] 96년 03월 24일 17:43		Page : 1 / 81// [등록자] JUNGHT// [제	목] [피터팬]MUN님강좌(59-74)화일편집(본인께죄송)//───────────────────────────────────────	while(1) {		strcpy(buff1,"");		if (get_line(buff1)==No) break;  //1줄 입력		i=strlen(buff1);		if(i>30&&stristr(buff1,"[번  호]")&&stristr(buff1,"[등록일]")) {			if (get_line(buff2)==No) break;  //2번째 줄 읽음			i=strlen(buff2);			if(i>10&&stristr(buff2,"[등록자]")) {				if (get_line(buff3)==No) break;  //3번째 줄 읽음				i=strlen(buff3);				if(i>10&&stristr(buff3,"[제  목]")) {					if (get_line(buff4)==No) break;  //3번째 줄 읽음					i=strlen(buff4);					if(i>42&&strstr(buff4,"──────")) {						found=Yes;						if (fp2!=NULL) fclose(fp2);						bbs_save_add2(0);						fp2=fopen(TMP_FILE,"w");						//아이디 지정						for (i=10;i<18;i++) cname[i-10]=buff2[i];						cname[i]=0;del_space(cname);del_esc(cname);						strcpy(cid,cname);						//제목 지정						strcpy(bbs.title,&buff3[10]);						strcpy(bbs.filename,"");						bbs.read=0;						bbs.down=0;						bbs.ok=0;						bbs.filesize=0;						//키지정						strcpy(bbs.key,"        ");						for (i=10;i<18;i++) {							if (buff1[i]=='/') break;							buff[i-10]=buff1[i];						}						buff[7]=0;del_space(buff);del_esc(buff);						sprintf(bbs.key,"`%7.7s",buff);					}					else {	//아니면 저장함						strcat(buff1,"\n");						strcat(buff2,"\n");						strcat(buff3,"\n");						strcat(buff4,"\n");						fwrite(&buff1,sizeof(buff1),1,fp2);						fwrite(&buff2,sizeof(buff2),1,fp2);						fwrite(&buff3,sizeof(buff3),1,fp2);						fwrite(&buff4,sizeof(buff4),1,fp2);					}				}				else {	//아니면 저장함					strcat(buff1,"\n");					strcat(buff2,"\n");					strcat(buff3,"\n");					fwrite(&buff1,sizeof(buff1),1,fp2);					fwrite(&buff2,sizeof(buff2),1,fp2);					fwrite(&buff3,sizeof(buff3),1,fp2);				}			}			else {	//아니면 저장함				strcat(buff1,"\n");				strcat(buff2,"\n");				fwrite(&buff1,sizeof(buff1),1,fp2);				fwrite(&buff2,sizeof(buff2),1,fp2);			}		}		else {			strcat(buff1,"\n");			fputs(buff1,fp2);		}	}	if (fpin!=NULL) fclose(fpin);	if (fp2!=NULL) fclose(fp2);	bbs_save_add2(0);	printfL2();	if (!found) printf("\n 게시판 자동등록에 실패하였습니다. 사용법확인 \n");	else		printf("\n 게시판 자동등록이 모두 끝났습니다.\n");	pressenter();}now_bbs(int mode){	char buff[2000];	char bufft[2000];	char filename[2000];	char buff1[2000];	char buff2[2000];	char buff3[2000];	char buff4[2000];	char buff5[2000];	char t1[30];	char t2[30];	FILE *fp1;	FILE *fp2;	int found=No;	char txt_mode=No;	int i;	char wkey1[90];	char wkey2[90];	char wkey3[90];	char wkey4[90];	char wkey5[90];	char wkey6[90];	//화일을 전송받아 filename에 저장한다.	view("frm/txt2bbs/nowup.log");	_cont1:	if (!up_file(0,filename,No)) goto _fail;	if (bit(cfg.txtmode,2)) {						//조합형모드		if (!jo2ks(filename,TMP_FILE3)) goto _fail;		strcpy(filename,TMP_FILE3);	}	if ((fp1=fopen(filename,"r"))==NULL) goto _fail;	if ((fp2=fopen(TMP_FILE,"w"))==NULL) goto _fail;	printf("\n %s(%s) 에 추가되는 자료\n",go.code,go.name);	printfL2();	strcpy(bbs.title,"");	bbs.del=0;	bbs.read=0;	bbs.down=0;	bbs.gd=' ';	bbs.line=0;	time(&cdate);	if ((fpin=fopen(filename,"r+"))==NULL) return;	ntotal=file_size(filename);	unlink(TMP_FILE);	fp2=fopen(TMP_FILE,"w");	printf("\n %s(%s) 에 추가되는 자료\n",go.code,go.name);	printf(" 파일명:%s   (%d byte)\n",filename,file_size(filename));	printfL2();	strcpy(bbs.title,"");	strcpy(cid,pf.id);	strcpy(cname,pf.nick);	bbs.del=0;	bbs.read=0;	bbs.down=0;	bbs.gd=' ';	bbs.line=0;	strcpy(wkey1,"");	strcpy(wkey2,"");	strcpy(wkey3,"");	strcpy(wkey4,"");	strcpy(wkey5,"");	strcpy(wkey6,"");	if (mode==1) {		strcpy(wkey1,"『");strcpy(wkey2,")』");strcpy(wkey3," 제  목 :");		strcpy(wkey4," 올린이 :");strcpy(wkey5," 읽음 :");strcpy(wkey6," ----------------------------");	}	else if (mode==2) {		strcpy(wkey1,"『");strcpy(wkey2,")』");strcpy(wkey3," 제  목 :");		strcpy(wkey4," 올린시각 :");strcpy(wkey5," 읽음 :");strcpy(wkey6," ----------------------------");	}	else if (mode==3) {		strcpy(wkey1,"『");strcpy(wkey2,")』");strcpy(wkey3," 제  목:");		strcpy(wkey4," 올린이:");strcpy(wkey5," 읽음:");strcpy(wkey6," ----------------------------");	}	else if (mode==4) {		strcpy(wkey1,"『");strcpy(wkey2,")』");strcpy(wkey3," 제  목:");		strcpy(wkey4," 올린시각:");strcpy(wkey5," 읽음:");strcpy(wkey6," ----------------------------");	}	else if (mode==5) {		strcpy(wkey1,"『");strcpy(wkey2,")』");strcpy(wkey3," 제  목:");		strcpy(wkey4," 올린이:");strcpy(wkey5," 추천:");strcpy(wkey6," ----------------------------");	}	else if (mode==6) {		strcpy(wkey1," ");strcpy(wkey2,"번  호 :");strcpy(wkey3,"게시자 :");		strcpy(wkey4,"등록일 :");strcpy(wkey5,"등록일 :");strcpy(wkey6,"제  목 :");	}	else if (mode==7) {		strcpy(wkey1,"번");strcpy(wkey2," 제  목 : ");strcpy(wkey3," 검색어 : ");		strcpy(wkey4," 올린이 : ");strcpy(wkey5,"등록시각:");strcpy(wkey6," ");	}// ------------------------------------------------------------------------------// 제  목 : [ARC] 추억의 아케이드 게임 #39// 검색어 : 닌자/거북이/아케이드					 파일명 : tmnt.zip// 올린이 : 맨첨느낌(박동현)  파일크기 : 2376100 byte  조회 : 329	전송 : 14// -----------------------------------------------------------------------------	else if (mode==8) {		strcpy(wkey1," -");strcpy(wkey2," --------------------------------------------------------------");		strcpy(wkey3," 제  목 : ");		strcpy(wkey4," 검색어 : ");strcpy(wkey5,"파일명 : ");		strcpy(wkey6," 올린이 : ");	}// 제  목 : Memory 체크관련 소스					 파 일 명 : mem1.zip// 검색어 : 메모리/소스/source						 파일크기 : 7597 bytes// 올린이 : 운영자(nowpds)	등록시각:94/04/16 11:43:31	읽음 : 1955  받음 : 1147// 관련자료 없음	else if (mode==9) {		strcpy(wkey1," ");strcpy(wkey2,"파 일 명 : ");		strcpy(wkey3," 검색어 : ");		strcpy(wkey4," 올린이 : ");strcpy(wkey5,"읽음 : ");		strcpy(wkey6," 관련자료");	}//번  호 : 23143//게시자 : 김성훈	(리바	 )//등록일 : 1999-01-05 04:01//제  목 : 셀러론266CPU---448오버가능모델..	else if (mode==10) {		strcpy(wkey1,"번");strcpy(wkey2,"번  호 :");strcpy(wkey3,"게시자 :");		strcpy(wkey4,"등록일 :");strcpy(wkey5,"등록일 :");strcpy(wkey6,"제  목 :");	}// ------------------------------------------------------------------------------// 제  목 : [제안서문의]// 올린이 : ipwid	(김준호  )	 99/01/21 17:32   읽음 : 107		관련자료 없음// -----------------------------------------------------------------------------	else if (mode==11) {		strcpy(wkey1," -");strcpy(wkey2," -------------");strcpy(wkey3,"제  목 :");		strcpy(wkey4,"올린이 :");strcpy(wkey5,"읽음 :");strcpy(wkey6,"---");	}//『		게시판-열린광장 (go PLAZA)』 7번// 제  목 : 20세기 마지막 최고 역사의 순간이라// 올린이 : cho8	(조민석  )	  97/07/01 00:43	읽음 : 242	관련자료 없음// ----------------------------------------------------------------------------//『윈도우즈-추천 게시물 (go WIN)』 2번// 제  목 :   [강좌] 윈도 95의 비밀 - 윈95에 숨겨져 있는 유용한 팁.// 올린시각 : 97/06/15 00:58  읽음 : 3741  관련자료 없음// -----------------------------------------------------------------------------//『리눅스 사용자 모임-나의 리눅스 사용기와 팁 (go LINUX)』 2000번// 제  목:[참고] Tk에서 한글 필요하신분// 올린이:junker  (최준호  )	97/11/28 22:49	  읽음:324 관련자료 없음// -----------------------------------------------------------------------------//『등대-등대에서 알립니다 (go LOI)』 1번// 제  목:등대의 바람// 올린시각:95/01/24 10:57	읽음: 472 관련자료 없음// -----------------------------------------------------------------------------//『우스개 게시판-100명을 웃긴 베스트 유머 (go HUMOR)』 4000번// 제  목:찬호 박(Park)과 세리 박(Pak) ... ?						   읽음:10432// 올린이:harin   (임수정  )   작성:98/07/11 23:01		 추천:98/07/11 23:01// -----------------------------------------------------------------------------	txt_mode=No;	while(1) {		strcpy(buff1,"");		if (get_line(buff1)==No) break;  //1줄 입력		i=strlen(buff1);		strcpy(t1,"");		if (i>10) strncpy(t1,buff1,2);		if(i>10&&is_same(t1,wkey1)&&stristr(buff1,wkey2)) {			if (get_line(buff2)==No) break;  //2번째 줄 읽음			i=strlen(buff2);			if(i>10&&stristr(buff2,wkey3)) {				if (get_line(buff3)==No) break;  //3번째 줄 읽음				i=strlen(buff3);				if(i>22&&stristr(buff3,wkey4)&&stristr(buff3,wkey5)) {					if (get_line(buff4)==No) break;  //3번째 줄 읽음					i=strlen(buff4);					if(i>12&&strstr(buff4,wkey6)) {						if (mode==8&&get_line(buff5)==No) break;  //5번째 줄 읽음						found=Yes;						if (fp2!=NULL) fclose(fp2);						bbs_save_add2(0);						txt_mode=Yes;						fp2=fopen(TMP_FILE,"w");						//아이디 지정						if (mode==1) {							for (i=10;i<18;i++) cid[i-10]=buff3[i];							cid[i]=0;del_space(cid);del_esc(cid);							for (i=19;i<27;i++) cname[i-19]=buff3[i];							cname[i-18]=0;del_space(cname);del_esc(cname);							strcpy(buff,&buff2[10]);							all_trim(buff);							strncpy(bbs.title,buff,60);							if (!bit(cfg.txtmode,1)) {strcpy(buff,&buff3[30]);all_trim(buff);buff[18]=0;bbs.date=str2date2(buff);}						}						else if (mode==2) {							strcpy(cid,pf.id);							strcpy(cname,pf.nick);							strcpy(buff,&buff2[10]);							all_trim(buff);							strncpy(bbs.title,buff,60);							if (!bit(cfg.txtmode,1)) {strcpy(buff,&buff3[12]);all_trim(buff);buff[18]=0;bbs.date=str2date2(buff);}						}						else if (mode==3) {							for (i=8;i<8+8;i++) cid[i-8]=buff3[i];							cid[i]=0;del_space(cid);del_esc(cid);							for (i=17;i<17+8;i++) cname[i-17]=buff3[i];							cname[i]=0;del_space(cname);del_esc(cname);							strcpy(buff,&buff2[8]);							all_trim(buff);							strncpy(bbs.title,buff,60);							if (!bit(cfg.txtmode,1)) {strcpy(buff,&buff3[30]);all_trim(buff);buff[18]=0;bbs.date=str2date2(buff);}						}						else if (mode==4) {							strcpy(cid,pf.id);							strcpy(cname,pf.nick);							strcpy(buff,&buff2[8]);							all_trim(buff);							strncpy(bbs.title,buff,60);							if (!bit(cfg.txtmode,1)) {strcpy(buff,&buff3[10]);all_trim(buff);buff[18]=0;bbs.date=str2date2(buff);}						}						else if (mode==5) {							for (i=8;i<8+8;i++) cid[i-8]=buff3[i];							cid[i]=0;del_space(cid);del_esc(cid);							for (i=17;i<17+8;i++) cname[i-17]=buff3[i];							cname[i]=0;del_space(cname);del_esc(cname);							strcpy(buff,&buff2[8]);							all_trim(buff);							strncpy(bbs.title,buff,60);							if (!bit(cfg.txtmode,1)) {strcpy(buff,&buff3[34]);all_trim(buff);buff[18]=0;bbs.date=str2date2(buff);}						}						else if (mode==6) {							xstrncpy(cid,&buff2[9],8);del_space(cid);del_esc(cid);							xstrncpy(cname,&buff2[19],8);del_space(cname);del_esc(cname);							strcpy(buff,&buff4[9]);all_trim(buff);strncpy(bbs.title,buff,60);							if (!bit(cfg.txtmode,1)) {strcpy(buff,&buff3[9]);all_trim(buff);buff[18]=0;bbs.date=str2date2(buff);}						}						else if (mode==7) {							strcpy(buff,&buff3[10]);strchng2(buff,"("," ");strchng2(buff,")"," ");							check_cmd(buff);strcpy(cid,mmc[0]);strcpy(cname,mmc[1]);							xstrncpy(bbs.title,&buff1[10],40);all_trim(bbs.title);							strcpy(buff,buff1);							strchng2(buff,"파 일 명 :","           ");							strcpy(bufft,&buff[50]);del_space(bufft);							xstrncpy(bbs.filename,bufft,13);							if (!bit(cfg.txtmode,1)) {								strcpy(buff,buff3);								strchng2(buff,"동록시각:","             ");								strchng2(buff,"읽음 :","             ");								strcpy(bufft,&buff[28]);all_trim(bufft);bufft[18]=0;								bbs.date=str2date2(bufft);							}						}// 제  목 : Memory 체크관련 소스					 파 일 명 : mem1.zip// 검색어 : 메모리/소스/source						 파일크기 : 7597 bytes// 올린이 : 운영자(nowpds)	등록시각:94/04/16 11:43:31	읽음 : 1955  받음 : 1147// 관련자료 없음						else if (mode==8) {							strcpy(buff,&buff4[10]);strchng2(buff,"("," ");strchng2(buff,")"," ");							check_cmd(buff);strcpy(cid,mmc[0]);strcpy(cname,mmc[1]);							xstrncpy(bbs.title,&buff2[10],40);all_trim(bbs.title);							strcpy(buff,buff3);							strchng2(buff,"파일명 :","           ");							strcpy(bufft,&buff[58]);del_space(bufft);							xstrncpy(bbs.filename,bufft,13);							if (!bit(cfg.txtmode,1)) bbs.date=cdate;						}						else if (mode==9) {							strcpy(buff,&buff3[10]);strchng2(buff,"("," ");strchng2(buff,")"," ");							check_cmd(buff);strcpy(cid,mmc[0]);strcpy(cname,mmc[1]);							xstrncpy(bbs.title,&buff1[10],40);all_trim(bbs.title);							strcpy(buff,buff1);							strchng2(buff,"파 일 명 :","           ");							strcpy(bufft,&buff[58]);del_space(bufft);							xstrncpy(bbs.filename,bufft,13);							if (!bit(cfg.txtmode,1)) {								strcpy(buff,buff3);								strchng2(buff,"동록시각:","             ");								strchng2(buff,"읽음 :","             ");								strcpy(bufft,&buff[28]);all_trim(bufft);bufft[18]=0;								bbs.date=str2date2(bufft);							}						}//번  호 : 23143//게시자 : 김성훈	(리바	 )//등록일 : 1999-01-05 04:01//제  목 : 셀러론266CPU---448오버가능모델..						else if (mode==10) {							xstrncpy(cid,&buff2[19],8);del_space(cid);del_esc(cid);							xstrncpy(cname,&buff2[9],8);del_space(cname);del_esc(cname);							strcpy(buff,&buff4[9]);all_trim(buff);strncpy(bbs.title,buff,60);							if (!bit(cfg.txtmode,1)) {strcpy(buff,&buff3[9]);all_trim(buff);buff[18]=0;bbs.date=str2date2(buff);}						}// ------------------------------------------------------------------------------// 제  목 : [제안서문의]// 올린이 : ipwid	(김준호  )	 99/01/21 17:32   읽음 : 107		관련자료 없음// -----------------------------------------------------------------------------						else if (mode==11) {							xstrncpy(cid,&buff3[10],8);del_space(cid);del_esc(cid);							xstrncpy(cname,&buff3[19],8);del_space(cname);del_esc(cname);							strcpy(buff,&buff2[10]);all_trim(buff);strncpy(bbs.title,buff,60);							if (!bit(cfg.txtmode,1)) {strcpy(buff,&buff3[31]);all_trim(buff);buff[18]=0;bbs.date=str2date2(buff);}						}						bbs.read=0;						bbs.down=0;						bbs.ok=0;						bbs.filesize=0;						//키지정						strcpy(bbs.key,"");					}					else if (txt_mode) {						strcat(buff1,"\n");						strcat(buff2,"\n");						strcat(buff3,"\n");						strcat(buff4,"\n");						fwrite(&buff1,sizeof(buff1),1,fp2);						fwrite(&buff2,sizeof(buff2),1,fp2);						fwrite(&buff3,sizeof(buff3),1,fp2);						fwrite(&buff4,sizeof(buff4),1,fp2);					}				}				else if (txt_mode) {					strcat(buff1,"\n");					strcat(buff2,"\n");					strcat(buff3,"\n");					fwrite(&buff1,sizeof(buff1),1,fp2);					fwrite(&buff2,sizeof(buff2),1,fp2);					fwrite(&buff3,sizeof(buff3),1,fp2);				}			}			else if (txt_mode) {				strcat(buff1,"\n");				strcat(buff2,"\n");				fwrite(&buff1,sizeof(buff1),1,fp2);				fwrite(&buff2,sizeof(buff2),1,fp2);			}		}		else if(stristr(buff1," PRINTER/CAPTURE를 정지하고  [Enter]를 누르십시오.")) txt_mode=No;		else if(stristr(buff1," 번호 올린ID   등록날짜 파일명       크기  받음 제목 ")) txt_mode=No;		else if(stristr(buff1,"*** 출력종료 ***")) txt_mode=No;		else if (txt_mode) {			strcat(buff1,"\n");			fputs(buff1,fp2);		}	}	if (fpin!=NULL) fclose(fpin);	if (fp2!=NULL) fclose(fp2);	bbs_save_add2(0);	printfL2();	if (!found) goto _fail;	mess("게시판 자동등록이 모두 끝났습니다.");	goto _cont1;	return;	_fail:}now_news(){	char buff[2000];	char buff1[2000];	char buff2[2000];	char buff3[2000];	char buff4[2000];	char filename[2000];	char t1[30];	char t2[30];	FILE *fp1;	FILE *fp2;	int found=No;	int i;	char wkey1[90];	char wkey3[90];	char wkey4[90];	char wkey5[90];	//화일을 전송받아 filename에 저장한다.	view("frm/txt2bbs/textup.log");	if (!up_file(0,filename,No)) return;	if ((fpin=fopen(filename,"r+"))==NULL) return;	ntotal=file_size(filename);	unlink(TMP_FILE);	fp2=fopen(TMP_FILE,"w");	printf("\n %s(%s) 에 추가되는 자료\n",go.code,go.name);	printf(" 파일명:%s   (%d byte)\n",filename,file_size(filename));	printfL2();	strcpy(bbs.title,"");	strcpy(cid,pf.id);	strcpy(cname,pf.nick);	bbs.del=0;	bbs.read=0;	bbs.down=0;	bbs.gd=' ';	bbs.line=0;	strcpy(wkey1,"");	strcpy(wkey3,"");	strcpy(wkey4,"");	strcpy(wkey5,"");// -----------------------------------------------------------------------------// 뉴스제공시각 : 04/13 23:20					출처 : 한겨레신문// 제목 : [북한] 중, 북에 식량·비료 지원키로　　// -----------------------------------------------------------------------------		strcpy(wkey1,"---------------------------------------");		strcpy(wkey3,"뉴스제공시각 :");		strcpy(wkey4,"제목 :");		strcpy(wkey5,"---------------------------------------");	while(1) {		strcpy(buff1,"");		if (get_line(buff1)==No) break;  //1줄 입력		if(stristr(buff1,wkey1)) {			if (get_line(buff2)==No) break;  //2번째 줄 읽음			if(stristr(buff2,wkey3)) {				if (get_line(buff3)==No) break;  //3번째 줄 읽음				if(stristr(buff3,wkey4)) {					if (get_line(buff4)==No) break;  //3번째 줄 읽음					if(stristr(buff4,wkey5)) {						found=Yes;						if (fp2!=NULL) fclose(fp2);						bbs_save_add2(0);						fp2=fopen(TMP_FILE,"w");						//아이디 지정						for (i=16;i<21;i++) cid[i-16]=buff2[i];						cid[i]=0;del_space(cid);del_esc(cid);						for (i=22;i<27;i++) cname[i-22]=buff2[i];						cname[i-22]=0;del_space(cname);del_esc(cname);						//제목 지정						strcpy(bbs.title,&buff3[8]);						strcpy(bbs.filename,"");						bbs.read=0;						bbs.down=0;						bbs.ok=0;						bbs.filesize=0;						//키지정						strcpy(bbs.key,"");						if (!bit(cfg.txtmode,1)) {							strcpy(buff,&buff2[16]);buff[15]=0;							bbs.date=str2date3(buff);	  //mm/dd ...						}					}					else {	//아니면 저장함						strcat(buff1,"\n");						strcat(buff2,"\n");						strcat(buff3,"\n");						strcat(buff4,"\n");						fwrite(&buff1,sizeof(buff1),1,fp2);						fwrite(&buff2,sizeof(buff2),1,fp2);						fwrite(&buff3,sizeof(buff3),1,fp2);						fwrite(&buff4,sizeof(buff4),1,fp2);					}				}				else {	//아니면 저장함					strcat(buff1,"\n");					strcat(buff2,"\n");					strcat(buff3,"\n");					fwrite(&buff1,sizeof(buff1),1,fp2);					fwrite(&buff2,sizeof(buff2),1,fp2);					fwrite(&buff3,sizeof(buff3),1,fp2);				}			}			else {	//아니면 저장함				strcat(buff1,"\n");				strcat(buff2,"\n");				fwrite(&buff1,sizeof(buff1),1,fp2);				fwrite(&buff2,sizeof(buff2),1,fp2);			}		}		else {			strcat(buff1,"\n");			fputs(buff1,fp2);		}	}	if (fpin!=NULL) fclose(fpin);	if (fp2!=NULL) fclose(fp2);	bbs_save_add2(0);	printfL2();	if (!found) printf("\n 게시판 자동등록에 실패하였습니다. 사용법확인 \n");	else		printf("\n 게시판 자동등록이 모두 끝났습니다.\n");	pressenter();}//TMP_FILE 에서 현재 bbs 로 저장한다. 신규저장 내용까지 저장bbs_save_add2(int mode){	FILE *fp1;	FILE *fp2;	FILE *fp3;	FILE *fp4;	time_t t;	BBS  bbs2;	int i,lastposi;	int change_size;	int n;	char c;    char buff[3000];	if (bbs.title[0]==0) return No;	//게시물 총수 파악	bbs2.num=0;	bbs2.posi=0;	bbs2.size=0;	bbs2.line=0;    touch_file(NOW_FILE);    touch_file(NOW_FILED);	fp1=fopen(NOW_FILE,"r+");                     //제목화일    fseekend(fp1);    n=ftell(fp1)/sizeof_bbs;    if (n>0) {        n--;        fseek(fp1,n*sizeof_bbs,SEEK_SET);        fread(&bbs2,sizeof_bbs,1,fp1);    }    fclose(fp1);	NOW_ALLNO=bbs2.num;	bbs.posi=bbs2.posi+bbs2.size;	bbs.num=bbs2.num+1;	del_blacket(cid);			   // (),{} 제거	del_blacket(cname); 		   // (),{} 제거	strcpy(bbs.id,cid); 		   //현재의 아이디,이름	strcpy(bbs.name,cname);	bbs.read=0; 				   //읽은횟수	bbs.del=0;					   //삭제여부	if (bit(cfg.txtmode,1)) time(&bbs.date);	bbs.gd=' ';	bbs.size=0; 				//작성한 게시물의 길이	if (bbs.date==0) time(&bbs.date);	fp1=fopen(TMP_FILE,"r+");   //임시작성화일    fseekend(fp1);    bbs.size=ftell(fp1);    //작성한 게시물의 길이    fclose(fp1);	//내용저장	fp2=fopen(NOW_FILED,"r+");  //내용화일    fseekend(fp2);    bbs.posi=ftell(fp1);    //작성한 게시물의 길이	if (fp2==NULL) fp2=fopen(NOW_FILED,"w+");     //내용화일	if (fp2==NULL) return No;	fp3=fopen(TMP_FILE,"r+");   //임시작성화일	bbs.line=0;	if (fp3!=NULL) {		rewind(fp3);		fseek(fp2,bbs.posi,SEEK_SET);		for (i=0;i<bbs.size;i++) {			c=fgetc(fp3);			  //임시에서 읽어			fputc(c,fp2);			  //내용에 저장			if (c=='\n') bbs.line++;		}	}    fclose(fp2);    fclose(fp3);    fp1=fopen(NOW_FILE,"r+");                   //제목화일 저장함 추가	del_space(bbs.id);del_esc(bbs.id);	del_space(bbs.name);del_esc(bbs.name);	if (bbs.id[0]==0) strcpy(bbs.id,pf.id);	if (bbs.name[0]==0) strcpy(bbs.name,pf.id);	if (go.type=='o') {               //문제가 있다..비공개게시판에서 보낸것은..?		strcpy(bbs.id,".......");		strcpy(bbs.name,".......");	}	del_esc3(bbs.filename);del_esc3(bbs.id);del_esc3(bbs.name);    fseekend(fp1);    n=ftell(fp1)/sizeof_bbs;    fseek(fp1,n*sizeof_bbs,SEEK_SET);	fwrite(&bbs,sizeof_bbs,1,fp1);    fclose(fp1);	if (strlen(bbs.filename)>0) {        printf("%6d %-8s %-37.37s%13.13s%4d\n",bbs.num,bbs.id,bbs.title,bbs.filename,bbs.line);	}	else {        printf("%6d %-8s %-37.37s%4d P:%d S:%d\n",bbs.num,bbs.id,bbs.title,bbs.line,bbs.posi,bbs.size);	}	unlink(TMP_FILE);	//임시화일 삭제	NOW_ALLNO=bbs.num;	NOW_NO=bbs.num;	NOW_ALLREC++;    NOW_REC=NOW_ALLREC;    fflush(NULL);	return (Yes);}//TMP_FILE 에서 현재 bbs 로 저장한다. 신규저장 내용까지 저장//날짜,읽기 변경 안됨bbs_save_add3(int mode){	FILE *fp1;	FILE *fp2;	FILE *fp3;	FILE *fp4;	time_t t;	BBS  bbs2;	int i,lastposi;	int change_size;	int n;	char c;	char buff[2000];	if (strlen(bbs.title)<1) return No;	//게시물 총수 파악	bbs2.num=0;	bbs2.posi=0;	bbs2.size=0;	bbs2.line=0;	fp1=fopen(NOW_FILE,"r+");                     //제목화일	if (fp1!=NULL) {		fseekend(fp1);		n=ftell(fp1)/sizeof_bbs;		if (n>0) {			n--;			fseek(fp1,n*sizeof_bbs,SEEK_SET);			fread(&bbs2,sizeof_bbs,1,fp1);		}	}	if (fp1!=NULL) fclose(fp1);	NOW_ALLNO=bbs2.num;	bbs.posi=bbs2.posi+bbs2.size;	bbs.num=bbs2.num+1;	del_blacket(cid);			   // (),{} 제거	del_blacket(cname); 		   // (),{} 제거	strcpy(bbs.id,cid); 		   //현재의 아이디,이름	strcpy(bbs.name,cname);	bbs.del=0;					   //삭제여부	time(&t);	bbs.gd=' ';	bbs.size=0; 				//작성한 게시물의 길이	if (bbs.date==0) time(&bbs.date);	fp1=fopen(TMP_FILE,"r+");   //임시작성화일	if (fp1!=NULL) {		fseekend(fp1);		bbs.size=ftell(fp1);	//작성한 게시물의 길이	}	if (fp1!=NULL) fclose(fp1);	//내용저장	fp2=fopen(NOW_FILED,"r+");  //내용화일	if (fp2==NULL) fp2=fopen(NOW_FILED,"w+");     //내용화일	if (fp2==NULL) return No;	fp3=fopen(TMP_FILE,"r+");   //임시작성화일	bbs.line=0;	if (fp3!=NULL) {		rewind(fp3);		fseek(fp2,bbs.posi,SEEK_SET);		for (i=0;i<bbs.size;i++) {			c=fgetc(fp3);			  //임시에서 읽어			fputc(c,fp2);			  //내용에 저장			if (c=='\n') bbs.line++;		}	}	if (fp2!=NULL) fclose(fp2);	if (fp3!=NULL) fclose(fp3);	fp1=fopen(NOW_FILE,"a+");                   //제목화일 저장함 추가	if (fp1==NULL) fp1=fopen(NOW_FILE,"w+");    //제목화일 저장함 추가	if (go.type=='o') {               //문제가 있다..비공개게시판에서 보낸것은..?		strcpy(bbs.id,".......");		strcpy(bbs.name,".......");	}	del_esc3(bbs.filename);del_esc3(bbs.id);del_esc3(bbs.name);	fwrite(&bbs,sizeof_bbs,1,fp1);	if (fp1!=NULL) fclose(fp1);	printf("%6d %-8s %-13s *%s*\n",bbs.num,bbs.id,bbs.filename,bbs.title);	unlink(TMP_FILE);	//임시화일 삭제	NOW_ALLNO=bbs.num;	NOW_NO=bbs.num;	NOW_ALLREC++;	NOW_REC=NOW_ALLREC;	return (Yes);}//라인을 읽어 buff에 저장한다.	마지막 \n 등은 제거한다.int get_line(char *buff){	int i;	char ch;	int ret;	int n;	i=0;	strcpy(buff,"");	ret=Yes;	n=ftell(fpin);	if (n<0) n=0;	while(1) {		if (n++>=ntotal||feof(fpin)) {ret=No;break;}		if ((ch=fgetc(fpin))==EOF) {//			  if (i==0) ret=No;    //더이상의 글자 없음			break;		}//		  if (ch=='\r') continue;//		  if(i>300||ch=='\n'||ch=='\r') break;		if(i>300||ch=='\n') break;		else				buff[i++]=ch;	}	buff[i]=0;	if (i>0&&buff[i-1]=='\n') {i--;buff[i]=0;}	if (i>0&&buff[i-1]=='\r') {i--;buff[i]=0;}	return ret;}del_blacket(unsigned char *buff){	int i,n;	char buff2[2000];	i=0;	n=0;	while (buff[i]!=0) {		if ( !is_char(" ()[]{}",buff[i]) ) buff2[n++]=buff[i];		i++;	}	buff2[n]=0;	strcpy(buff,buff2);}//현재제목을 일괄편집한다.edit_title(){	FILE *fp1,*fp2;	DIR *dp;	struct dirent *dfp;	struct stat stbuf;	int count=1;	int i,n;	char filename[300];	char tNOW_FILE[200];	char tNOW_FILED[200];	char buff[2000];	char buff1[2000];	BBS bbs2;	strcpy(filename,NOW_FILE);	strchng2(filename,".tit",".ttt");	sprintf(tNOW_FILE ,"tmp/tmp6%d%s",cfg.hostno,no_spc(tty));   //호스트번호별임시화일	sprintf(tNOW_FILED,"tmp/tmp7%d%s",cfg.hostno,no_spc(tty));   //호스트번호별임시화일	unlink(tNOW_FILE);	unlink(tNOW_FILED);	fp1=fopen(NOW_FILE,"r");	if (fp1==NULL) return;	fp2=fopen(TMP_FILE,"w");	if (fp2==NULL) {fclose(fp1);return;}	while (fread(&bbs,sizeof_bbs,1,fp1)) {		sprintf(buff,"%c%7d %-8s %-8s %-12s %s\n",			bbs.del?'D':' ',bbs.num,bbs.id,bbs.name,bbs.filename,bbs.title);		fprintf(fp2,buff);	}	fclose(fp1);	fclose(fp2);	sys_tem("bin/rfile %s %s",TMP_FILE,filename);	file_copy(NOW_FILE,tNOW_FILE);	file_copy(NOW_FILED,tNOW_FILED);	mess("이 기능을 사용하면 게시판 내용이 지워질수 있으니 주의하세요");	printf("\n");	while (1) {		printf("FILE : %s(%dB/%d)\n",NOW_FILE,file_size(NOW_FILE),count_rec(NOW_FILE,sizeof_bbs));		printf("FILED: %s(%dB)\n"   ,NOW_FILED,file_size(NOW_FILED));		printf("임시 : %s(%dB/%d)\n",tNOW_FILE ,file_size(tNOW_FILE ),count_rec(tNOW_FILE,sizeof_bbs));		printf("임시D: %s(%dB)\n"   ,tNOW_FILED,file_size(tNOW_FILED));		printf("제목 : %s(%dB/%d)\n",filename,file_size(filename),count_line(filename));		printf("   1. 제목 편집 (ED)          \n");		printf("   2. 제목 전송 (DN) (다운)   \n");		printf("   3. 제목 등록 (UP) (갱신)   \n");		printf("   4. 게시물 -> 임시 저장 이동  \n");		printf("   5. 게시물 <- 임시 저장 이동  \n");		n=numselect();		if (n==0) break;		if (n==1) xedit(filename);		else if (n== 2) sz_file(filename);	//다운받아서지정화일로 바꾼다.		else if (n== 3) {			//다운받아서지정화일로 바꾼다.			if (rz_file(buff)&&file_size(buff)>0) {				printf("\n 등록파일:%s  크기:%d Byte\n",buff,file_size(buff));				if (yesno2(" 이 파일을 등록할까요? (Y/n)>>",Yes)) {					file_copy(buff,filename);					sys_tem("bin/rfile %s %s",filename,TMP_FILE2);					fp1=fopen(TMP_FILE2,"r");					if (fp1==NULL) continue;					while (fgets(buff,300,fp1)) {						if (strlen(buff)<5) continue;						del_enter(buff);						strcpy(buff1,&buff[1]);						bbs2.num=atoi(buff1);						xstrncpy(bbs2.id,&buff[9],8);						xstrncpy(bbs2.name,&buff[18],8);						xstrncpy(bbs2.filename,&buff[27],12);						xstrncpy(bbs2.title,&buff[40],60);						del_space(bbs2.id);del_space(bbs2.name);del_space(bbs2.filename);						all_trim(bbs2.title);						time(&bbs2.date);						time(&bbs2.date2);						bbs.del=bbs2.del;						del_esc3(bbs2.filename);del_esc3(bbs2.id);del_esc3(bbs2.name);						if (bbs2.num>0&&bbs_num(bbs2.num)) {							strcpy(bbs.id,bbs2.id);							strcpy(bbs.name,bbs2.name);							strcpy(bbs.filename,bbs2.filename);							strcpy(bbs.title,bbs2.title);							sprintf(buff,"%s/%s",go.dir,bbs.filename);							bbs.filesize=file_size(buff);							if ((fp2=fopen(NOW_FILE,"r+"))!=NULL) {								fseek(fp2,NOW_REC*sizeof_bbs,SEEK_SET);								if (!feof(fp2)) fwrite(&bbs,sizeof_bbs,1,fp2);								fclose(fp2);							}						}						else {							strcpy(bbs.id,bbs2.id);							strcpy(bbs.name,bbs2.name);							strcpy(bbs.filename,bbs2.filename);							strcpy(bbs.title,bbs2.title);							sprintf(buff,"%s/%s",go.dir,bbs.filename);							bbs.filesize=file_size(buff);							bbs_add(9);						}						printf("%c%7d %-8s %-8s %-12s %s\n",							bbs.del?'D':' ',bbs.num,bbs.id,bbs.name,bbs.filename,bbs.title);					}					fclose(fp1);				}			}			unlink(buff);		}		else if (n==4) {			file_move(NOW_FILE,tNOW_FILE);			file_move(NOW_FILED,tNOW_FILED);		}		else if (n==5) {			file_move(tNOW_FILE,NOW_FILE);			file_move(tNOW_FILED,NOW_FILED);		}	}	if (file_size(NOW_FILE)<1&&yesno2(" 현재 게시판의 내용이 없습니다.\n다시 원래의 내용으로 복구할까요?(Y/n)>>",Yes)) {		file_move(tNOW_FILE,NOW_FILE);		file_move(tNOW_FILED,NOW_FILED);	}	unlink(filename);	unlink(tNOW_FILE);	unlink(tNOW_FILED);}//해당 되는 번호를 찾아 bbs에 저장int bbs_num(int num){	BBS bbs1;	int i,n,found=No;	FILE *fp;	int last,first,now;	fp=fopen(NOW_FILE,"r");	if (fp==NULL) return No;	//먼저 인덱스 검색	first=1;	fseekend(fp);	last=ftell(fp)/sizeof_bbs;	now=last/2+1;	while(1) {		fseek(fp,(now-1)*sizeof_bbs,SEEK_SET);		if (fread(&bbs1,sizeof_bbs,1,fp)) {			if (bbs1.num==num) {				found=Yes;				NOW_REC=now-1;				break;			}			else if ((last-first<5)||now<0) break;			else if (bbs1.num>num) last=now;			else				   first=now;			now=(last-first)/2+first+1;		}		else break;	}	if (!found) {		i=now-15;if (i<0) i=0;		for (n=i;n<now+30;n++) {			fseek(fp,n*sizeof_bbs,SEEK_SET);			if (fread(&bbs1,sizeof_bbs,1,fp)) {				if (bbs1.num==num) {					NOW_REC=n;					found=Yes;					break;				}			}		}	}	if (!found) {  //검색 실패시 처음부터 검색		fseekend(fp);		last=ftell(fp)/sizeof_bbs;		rewind(fp);		for (i=0;i<last;i++) {			fread(&bbs1,sizeof_bbs,1,fp);			if (bbs1.num==num) {				found=Yes;				NOW_REC=i;				break;			}		}	}	fclose(fp);	if (found) {		re_print=Yes;		bbs=bbs1;		NOW_NO=bbs1.num;	}	return(found);}//현재 bbs 구조체를 저장한다.(내용은 TMP_FILE에 저장이 되어야 한다.)//mode=1 이면 완벽하게 복구함 (bbs,NOW_REC 등등)//mode=9 내용추가 안함bbs_add(int mode){	FILE *fp1,*fp2,*fp3,*fp4;	time_t t;	BBS  bbs2,bbs3,oldbbs;	int i,lastposi,change_size,n,n2,now_size;	char c;	char buff[2180];	int tNOW_ALLNO	 =NOW_ALLNO ;	//복구를 위해	int tNOW_NO 	 =NOW_NO	;	int tNOW_ALLREC  =NOW_ALLREC;	int tNOW_REC	 =NOW_REC	;	char new_file=No;	oldbbs=bbs;	//게시물 총수 파악	bbs2.num=0;	bbs2.posi=0;	bbs2.size=0;	bbs3=bbs2;	n=0;	now_size=file_size(NOW_FILE);	c_lock(1,NOW_FILE); 				  //LOCK확인  1:확인 2:종료	fp1=fopen(NOW_FILE,"r");                     //제목화일	if (fp1==NULL) {		new_file=Yes;				   //새로운화일임		touch_file(NOW_FILE);		touch_file(NOW_FILED);	}	else {		i=0;		fseekend(fp1);					  //제일 마지막 자료를 찾기		n=ftell(fp1)/sizeof_bbs;				  //자료의 총수		if (n>0) {			fseek(fp1,(n-1)*sizeof_bbs,SEEK_SET);			fread(&bbs2,sizeof_bbs,1,fp1);		}		fclose(fp1);	}	bbs.posi=bbs2.posi+bbs2.size;	//새로운 bbs위치	bbs.num=bbs2.num+1;	if (new_file) {		bbs.posi=0;		bbs.num=1;		NOW_ALLREC=0;		NOW_REC=0;	}	//임시에서 읽어 내용저장 (fp2->fp3)	bbs.line=1;	bbs.size=file_size(TMP_FILE);		//임시작성화일	if (bbs.size<1) bbs.size=0;	if (mode==9) bbs.size=0;		//내용추가 안함;	if (bbs.size>0) {		if (new_file) fp2=fopen(NOW_FILED,"w+");      //내용화일		else {			if ((fp2=fopen(NOW_FILED,"r+"))==NULL)				fp2=fopen(NOW_FILED,"w+");      //내용화일		}		if (bcfg.limitsize>0&&bbs.size>bcfg.limitsize) bbs.size=bcfg.limitsize;  //게시물 내용크기 제한		if (bbs.size<0) bbs.size=0;		fp3=fopen(TMP_FILE,"r");          //임시작성화일		if (fp2!=NULL&&fp3!=NULL) {			rewind(fp3);			fseek(fp2,bbs.posi,SEEK_SET);			for (i=0;i<bbs.size;i++) {				c=fgetc(fp3);			  //임시에서 읽어				if (c=='\n') bbs.line++;  //줄수 계산				fputc(c,fp2);			  //내용에 저장			}			fclose(fp3);		}		if (fp2!=NULL) fclose(fp2);	}	if (go.type=='o') {		strcpy(bbs.id,"........");		strcpy(bbs.name,"........");	}	del_space(bbs.passwd);	del_tab(bbs.title);	//제목화일 저장	if (new_file) fp1=fopen(NOW_FILE,"w+");                   //제목화일 저장함 추가	else		  fp1=fopen(NOW_FILE,"r+");                   //제목화일 저장함 추가	if (fp1!=NULL) {		fseekend(fp1);		n=ftell(fp1)/sizeof_bbs;		if (new_file||n<0||n>1000000) n=0;		fseek(fp1,n*sizeof_bbs,SEEK_SET);		del_esc3(bbs.filename);del_esc3(bbs.id);del_esc3(bbs.name);		if (!feof(fp1)) fwrite(&bbs,sizeof_bbs,1,fp1);		fclose(fp1);	}	NOW_ALLNO=bbs.num;	NOW_NO=bbs.num;	NOW_ALLREC++;	NOW_REC=NOW_ALLREC-1;	if (mode==1) {		NOW_ALLNO	=tNOW_ALLNO ;		NOW_NO		=tNOW_NO	;		NOW_ALLREC	=tNOW_ALLREC;		NOW_REC 	=tNOW_REC	;		bbs=oldbbs;	}	return_yes:	c_lock(0,NOW_FILE); 				  //LOCK확인  1:확인 0:종료	return (Yes);	return_no:	c_lock(0,NOW_FILE); 				  //LOCK확인  1:확인 0:종료	return No;}bbs_bbs(){	FILE *fp,*fp1,*fp2,*fp3,*fp4,*fp5;	char buff[2280],buff1[2280],buff2[2280],buff3[2280];	char filename[2000];	char tcodestr[2000];	char NOW_FILE2[300];	char NOW_FILED2[300];	int i,n,mode,n1,n2,n3,nn,num;	int now_pos,last_num,count=0;	int anum[500];	BBS bbs2;	printf("\n 추가할 게시판 파일을 지정하세요..  (.txt,.tit는 제외)\n");	printf(" >>");	lineinput(buff,100);check_han(buff);printf("\n");	if (stristr(buff,"userdata/")) goto _fail;	if (stristr(buff,"system/")) goto _fail;	if (strlen(buff)<2) return;	strchng2(buff,".tit","");	strchng2(buff,".txt","");	sprintf(NOW_FILE ,"%s/menu/%s.tit",club_go.dir,go.code);	strchng(NOW_FILED,NOW_FILE,".tit",".txt");	sprintf(NOW_FILE2,"%s.tit",buff);              //가기코드	sprintf(NOW_FILED2,"%s.txt",buff);              //가기코드	if (!is_file(NOW_FILE2)) {		printf("%s 파일이 없습니다.\n",NOW_FILE2);		goto _fail;	}	printfL2();	printf("FILE:%-30.30s SIZE:%-5d REC:%d\n",NOW_FILE  ,file_size(NOW_FILE  ),count_rec(NOW_FILE  ,sizeof_bbs));	printf("    :%-30.30s SIZE:%-5d       \n",NOW_FILED ,file_size(NOW_FILED ));	printf("DATA:%-30.30s SIZE:%-5d REC:%d\n",NOW_FILE2 ,file_size(NOW_FILE2 ),count_rec(NOW_FILE2 ,sizeof_bbs));	printf("    :%-30.30s SIZE:%-5d       \n",NOW_FILED2,file_size(NOW_FILED2));	printfL2();	fp1=fopen(NOW_FILE2,"r");  if(fp1==NULL) goto _fail;	fp2=fopen(NOW_FILED2,"r");	fp3=fopen(NOW_FILE,"r+");  if(fp3==NULL) fp3=fopen(NOW_FILE ,"w+");	fp4=fopen(NOW_FILED,"r+"); if(fp4==NULL) fp4=fopen(NOW_FILED,"w+");	//기존게시판의 최고 마지막 자료 찾기	fseek(fp3,0,SEEK_END);	n=ftell(fp3)/sizeof_bbs;	now_pos=0;	last_num=0;	if (n>0) {		fseek(fp3,(n-1)*sizeof_bbs,SEEK_SET);		if (fread(&bbs,sizeof_bbs,1,fp3)) {			now_pos=bbs.posi+bbs.size;			last_num=bbs.num;		}	}	fseek(fp1,0,SEEK_SET);	fseek(fp2,0,SEEK_SET);	fseek(fp3,n*sizeof_bbs,SEEK_SET);	fseek(fp4,0,SEEK_SET);	while(fread(&bbs,sizeof_bbs,1,fp1)) {		if (bbs.size<0||bbs.size>1000000) bbs.size=100000;		bbs2=bbs;		bbs2.posi=now_pos;		bbs2.num=last_num+1;		now_pos=bbs2.posi+bbs2.size;		last_num++;		fwrite(&bbs2,sizeof_bbs,1,fp3);		if (fp2!=NULL) {			fseek(fp2,bbs.posi,SEEK_SET);			fseek(fp4,bbs2.posi,SEEK_SET);			for (i=0;i<bbs2.size;i++) {				fputc(fgetc(fp2),fp4);			}		}		printf("추가->%5d. %-8s %-8s %-30.30s\n",bbs2.num,bbs2.id,bbs2.name,bbs2.title);		count++;	}	fclose(fp1);	fclose(fp2);	fclose(fp3);	fclose(fp4);	mess(" 총 %d 자료 추가됨",count);	return;	_fail:	mess(" 자료 추가 취소");	return;}//내용을 조합형에서 완성형으로 바꾼다.jo2ks(char *file1,char *file2){	if (!is_file(file1)) mess("%s 파일이 없습니다",file1);	else {		sys_tem("bin/xhcode %s %s",file1,file2);		if (!is_file(file2)) {			mess("xhcode 완성형 변환 실패 %s->%s",file1,file2);			return No;		}		return Yes;	}	return No;}conv_bbs(){	int n;	while (1) {		sys_tem("rm -rf tmp/up%d%s",cfg.hostno,no_spc(tty));		cls();		printf("  1. WWW 날짜/제목 1         \n");		printf("  2. WWW 날짜/제목 2         \n");		printf("  3. KIDS 게시판 자동 등록  글쓴이:/날  짜:/제  목:\n");        printf("  4. 파일+\'\'[[형식TEXT자동 등록\n");		n=numselect();		if (n<=0) break;		else if (n==1) www_bbs(1);		else if (n==2) www_bbs(2);		else if (n==3) kids_bbs();		else if (n==4) txt_bbs2();	}}/*12/07(월) 19:27[30초 경영학] 망한 일본회사 `100년사' 발간망한 회사의 100년 사사가 나왔다. 일본 야마이치 증권의 한 사사 편찬실 직원이 재취업을 포기한 채 지난 4월부터 혼자 자료를 수집하 고 사원들의 증언을 토대로 회사가*/www_bbs(int mode){	char buff[2000];	char buff1[2000];	char buff2[2000];	char buff3[2000];	char buff4[2000];	char filename[2000];	char ch,ch1,ch2,ch3;	FILE *fp1;	FILE *fp2;	int fp2open=No;	int found=No;	int i,n,n1,n2,n3;	//화일을 전송받아 filename에 저장한다.	view("frm/txt2bbs/hit_up2.log");	if (!up_file(0,filename,No)) return;	if ((fpin=fopen(filename,"r"))==NULL) goto _fail;	ntotal=file_size(filename);	unlink(TMP_FILE);	fp2=fopen(TMP_FILE,"w");	fp2open=Yes;	printf("\n %s(%s) 에 추가되는 자료\n",go.code,go.name);	printf(" 파일명:%s   (%d byte)\n",filename,file_size(filename));	printfL2();	strcpy(bbs.title,"");	bbs.del=0;	bbs.read=0;	bbs.down=0;	bbs.gd=' ';	bbs.line=0;	strcpy(cid,pf.id);	strcpy(cname,pf.nick);	while(1) {		strcpy(buff,"");		bzero(buff1,2000);		bzero(buff2,2000);		bzero(buff3,2000);		bzero(buff4,2000);		if (get_line(buff1)==No) break;  //1줄 입력		all_trim(buff1);		if (strlen(buff1)>13&&strlen(buff1)<17&&buff1[2]=='/'&&is_char(buff1,'(')&&is_char(buff1,')')&&is_char(buff1,':')) {			_loop1:			if (get_line(buff2)==No) break;  //2번째 줄 읽음			all_trim(buff2);			if (strlen(buff2)<1) goto _loop1;			if (mode==2||stristr(buff2,"[")) {				found=Yes;				if (fp2!=NULL) fclose(fp2);				bbs_save_add2(0);				fp2=fopen(TMP_FILE,"w");				strcpy(bbs.title,"");				strcpy(bbs.filename,"");				sprintf(bbs.key,"");				bbs.filesize=0;				if (!bit(cfg.txtmode,1)) {					sprintf(buff4,"%04d/",nyear);					strchng2(buff1,"(","");strchng2(buff1,")","");					strchng2(buff1,"월","");strchng2(buff1,"화","");					strchng2(buff1,"수","");strchng2(buff1,"목","");					strchng2(buff1,"금","");strchng2(buff1,"토","");					strchng2(buff1,"일","");strchng2(buff1,"  "," ");					strcat(buff4,buff1);					bbs.date=str2date2(buff4);				}				all_trim(buff2);			//제목으로 지정				if (mode==1) {					strchng8(buff2,"] ");					strchng2(buff2,"] ","");					all_trim(buff2);			//제목으로 지정				}				xstrncpy(bbs.title,buff2,60);			}			else {	//아니면 저장함				if (fp2==NULL) fp2=fopen(TMP_FILE,"w");				fprintf(fp2,"%s\n",buff1);				fprintf(fp2,"%s\n",buff2);			}		}		else {	//아니면 저장함			if (stristr(buff1,"Copyright (c)")&&stristr(buff1,"reserved"));			else if (stristr(buff1,"Contact web")&&stristr(buff1,"for more"));			else if (stristr(buff1,"--------------------------"));			else if (stristr(buff1,"입력")&&stristr(buff1,"이전화면")&&stristr(buff1,"초기화면"));			else {				if (fp2==NULL) fp2=fopen(TMP_FILE,"w");				fprintf(fp2,"%s\n",buff1);			}		}	}	if (fpin!=NULL) fclose(fpin);	if (fp2!=NULL) fclose(fp2);	bbs_save_add2(0);	if (!found) goto _fail;	mess("게시판 자동등록이 모두 끝났습니다.");	return;	_fail:	mess("게시판 자동등록에 실패하였습니다.");}txt_bbs2(){	FILE *fp1,*fp2,*fp3,*fp4,*fprec;	char newdir[300];	char buff[2000];	char buff0[2000];	char buff1[2000];	char buff2[2000];	char ch,boxmode=No;	int i,n,ii,mode;	char filename[300];	time_t cdate;	time(&cdate);	fp1=NULL;	fp2=NULL;	//화일을 전송받아 filename에 저장한다.	view("frm/txt2bbs/textup2.log");	if (!up_file(0,filename,No)) goto _fail;	printf("\n %s(%s) 에 추가되는 자료\n",go.code,go.name);	printf(" 파일명:%s   (%d byte)\n",filename,file_size(filename));	ntotal=file_size(filename);	if ((fpin=fopen(filename,"r"))==NULL) goto _fail;/* [300] 제목 :  후장시황 (5월 25일 월요일)*/	bzero(buff0,2000);	   //메뉴번호	bzero(buff1,2000);	   //제목	fp2=fopen(TMP_FILE,"w");	strcpy(bbs.title,"");	time(&bbs.date);	boxmode=No;	while(1) {		strcpy(buff0,"");strcpy(buff1,"");		if (get_line(buff)==No) break;	//1줄 입력		xstrncpy(buff2,buff,5);		if(is_same(buff2,"\'\'///")) continue;		if(is_same(buff2,"\'\'//Q")) break;		if(is_same(buff2,"\'\'[[[")) {			if (!boxmode) {				boxmode=Yes;				fprintf(fp2,"   ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n");			}			else if (boxmode) {				boxmode=No;				fprintf(fp2,"   ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛\n");			}			continue;		}/* 제  목:[RA]강추! EVA! '무한포옹' 입니다.        분류:SDATA    전송:310    1/ 1 파일명:eva_5.ra	 크기:1629108  UP:1998-09-26 DN:1998-10-27 등록자: jungjjj*/		else if(strlen(buff)>15&&stristr(buff,"제  목:")&&stristr(buff,"전송:")) {			ii=0;			if (boxmode&&fp2!=NULL) {				fprintf(fp2,"   ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛\n");			}			boxmode=No;			if (fp2!=NULL) fclose(fp2);			bbs_save_add2(0);			fp2=fopen(TMP_FILE,"w");//		   제  목:[RA]강추! EVA! '무한포옹' 입니다.        분류:SDATA    전송:310    1/ 1			strcpy(buff2,buff);			strchng9(buff2,"분류:");			strchng2(buff2,"제  목:","");			all_trim(buff2);			strcpy(bbs.title,buff2);			strcpy(buff2,buff);			strchng8(buff2,"분류:");			strchng2(buff2,"분류:","");			xstrncpy(bbs.key,buff2,8);			all_trim(bbs.key);			if (get_line(buff)==No) break;	//1줄 입력			strcpy(buff2,buff);			strchng9(buff2,"크기:");			strchng2(buff2,"파일명:","");			all_trim(buff2);del_space(buff2);			strcpy(bbs.filename,buff2);			del_esc3(bbs.filename);			strcpy(buff2,buff);			strchng8(buff2,"등록자:");			strchng2(buff2,"등록자:","");			all_trim(buff2);del_space(buff2);del_esc(buff2);			xstrncpy(bbs.id,buff2,8);			xstrncpy(bbs.name,buff2,8);			bbs.date=cdate;			bbs.filesize=0;			if (!bit(cfg.txtmode,1)) {				strcpy(buff2,buff);				strchng8(buff2,"UP:");				strchng9(buff2,"DN:");				strchng2(buff2,"UP:","");				all_trim(buff2);del_space(buff2);del_esc(buff2);				bbs.date=str2date2(buff2);			}		}		else if (boxmode) {			all_trim(buff); 	 //양쪽에서 빈공간 제거하기  2->1			fprintf(fp2,"   ┃  %-68.68s┃\n",buff);		}		else {			strcat(buff,"\n");			fputs(buff,fp2);		}	}	if (fpin!=NULL) fclose(fpin);	if (fp2!=NULL) fclose(fp2);	bbs_save_add2(0);	return;	_fail:	if (fp1!=NULL) fclose(fp1);	if (fp2!=NULL) fclose(fp2);	mess("게시판 자동등록에 실패하였습니다.");	return;}kids_bbs(){	char dir[2000];	char buff[2000];	char buff1[2000];	char filename[2000];	int ret=No;	DIR *dp;	struct dirent *dfp;	printf (" kids_bbs 게시판디렉토리 지정 (예:/kids/bbs) \n >>");	lineinput(dir,100);check_han(dir);printf("\n");	if (strlen(dir)<1||is_same(dir,"q")||is_same(dir,"p")) return;	sprintf(buff,"ls %s",dir);system(buff);	if (yesno2(" 현재 이 자료로 게시판 변환을 시작할까요? (Y/n)",Yes)==No) return;	//디렉토리에서 bbs*을 읽어낸다.	printf("\n %s(%s) 에 추가되는 자료\n",go.code,go.name);	dp= opendir(dir);	while((dfp=readdir(dp)) != NULL) {		if(strlen(dfp->d_name)>1) {			sprintf(filename,"%s/%s",dir,dfp->d_name);			if (is_file(filename))				kids_bbs2(filename);  //file을 NOW_FILE에 추가한다.		}	}	closedir(dp);	printf(" ................ 종료 .............\n");	pressenter();}kids_bbs2(char *filename){	char buff[2000];	char buff1[2000];	char buff2[2000];	char buff3[2000];	char bufft[100];	char ch,ch1,ch2,ch3;	FILE *fp1;	FILE *fp2;	int fp2open=No;	int found=No;	int i,i2,start;	if ((fpin=fopen(filename,"r"))==NULL) return;	unlink(TMP_FILE);	fp2open=Yes;	strcpy(bbs.title,"");	strcpy(bbs.filename,"");	strcpy(bbs.key,"");	bbs.del=0;	bbs.read=0;	bbs.down=0;	bbs.gd=' ';	bbs.line=0;	bbs.filesize=0;//글쓴이: outsider (하얀까마귀)//날  짜: Fri Dec  5 22:41:13 1997//제  목: 학교에서 비자 받기..?////방학중에 볼일이 생겨서 미국에 갈지도 모르겠습니다. 비자와 여권을 만들어 두려고//하는데, 학생신분에 가장 쉽게 만드는게 학교 통하는 거라더군요. 어디 가서	if (fgets(buff1,200,fpin)==NULL||strlen(buff1)<10||!stristr(buff1,"글쓴이:")) {fclose(fpin);return;}	if (fgets(buff2,200,fpin)==NULL||strlen(buff2)<10||!stristr(buff2,"날  짜:")) {fclose(fpin);return;}	if (fgets(buff3,200,fpin)==NULL||strlen(buff3)<10||!stristr(buff3,"제  목:")) {fclose(fpin);return;}	strchng2(buff1,"(","");strchng2(buff1,")","");strchng2(buff1,":","");	strchng2(buff1,",","");strchng2(buff1,"-","");	check_cmd(buff1);	strcpy(cid	,mmc[1]);	strcpy(cname,mmc[2]);	xstrncpy(bufft,&buff2[28],4);strcpy(buff,bufft);strcat(buff,"-");	xstrncpy(bufft,&buff2[12],3);if (is_same(bufft,"jan")) strcat(buff,"01-");								 if (is_same(bufft,"feb")) strcat(buff,"02-");								 if (is_same(bufft,"mar")) strcat(buff,"03-");								 if (is_same(bufft,"apr")) strcat(buff,"04-");								 if (is_same(bufft,"may")) strcat(buff,"05-");								 if (is_same(bufft,"jun")) strcat(buff,"06-");								 if (is_same(bufft,"jul")) strcat(buff,"07-");								 if (is_same(bufft,"aug")) strcat(buff,"08-");								 if (is_same(bufft,"sep")) strcat(buff,"09-");								 if (is_same(bufft,"oct")) strcat(buff,"10-");								 if (is_same(bufft,"nov")) strcat(buff,"11-");								 if (is_same(bufft,"dec")) strcat(buff,"12-");	xstrncpy(bufft,&buff2[16],2);strcat(buff,bufft);strcat(buff," ");	xstrncpy(bufft,&buff2[18],8);strcat(buff,bufft);	bbs.date=str2date2(buff);	bbs.date2=bbs.date;	strcpy(bbs.title,&buff3[8]);all_trim(bbs.title);	all_trim(bbs.id);del_esc3(bbs.id);	all_trim(bbs.name);del_esc3(bbs.name);	fgets(buff,2000,fpin);	unlink(TMP_FILE);	fp2=fopen(TMP_FILE,"w");	while (fgets(buff,2000,fpin)) {		fprintf(fp2,"%s",buff);	}	fclose(fp2);	fclose(fpin);	bbs_save_add2(0);}xformat(){	int n;	while (1) {		cls();		printf("  1. XFORMAT 자료 등록 (자료추가)\n");		printf("  2. XFORMAT 자료 출력 (자료추출)\n");		n=numselect();		if (n<=0) break;		else if (n==1) xformat1();		else if (n==2) xformat2();	}}//__[[번호[[10//__[[제목[[[건의] 버그인지..아니면 수정중이신지..//__[[아이[[k2pbri1//__[[이름[[풀뿌리xformat1(){	FILE *fp1;	char buff[1010];	char buff1[100010];	char buff2[100010];	char ch,ch1,ch2,ch3,ch4;	char filename[300];	int found=No;    int i,text_mode=No,imode;	char tNOW_FILE[300];	char tNOW_FILED[300];	strcpy(tNOW_FILE,NOW_FILE);strcpy(tNOW_FILED,NOW_FILED);	//화일을 전송받아 filename에 저장한다.	printf("\n XFORMAT TEXT 파일데이타를 전송하세요\n");	_cont1:	if (!up_file(0,filename,No)) return;	unlink(TMP_FILE);	if ((fp1=fopen(filename,"r"))==NULL) return;	ntotal=file_size(filename);	unlink(TMP_FILE);	printf("\n %s(%s) 에 추가되는 자료\n",go.code,go.name);	printf(" 파일명:%s   (%d byte)\n",filename,file_size(filename));	printfL2();	clear_bbs();    text_mode=No;    imode=10;	while(fgets(buff1,100000,fp1)!=NULL) {		bzero(buff,100);		bzero(buff2,100000);		del_enter2(buff1);        xstrncpy(buff,buff1,10);        strcpy(buff2,&buff1[10]);        if (buff[0]=='_'&&buff[1]=='_'&&buff[2]=='['&&buff[3]=='['&&buff[8]=='[') imode=10;        if (buff[0]=='_'&&buff[1]=='['&&buff[2]=='['&&buff[7]=='[') imode=9;		if (strlen(buff2)<100) all_trim(buff2);//        if (bbs.num>=0) {printf(" B1*%s*%s B2*%s*",buff1,buff,buff2);pressenter();}             if (stristr(buff,"_[[종료[[")) break;        else if (stristr(buff,"_[[중지[[")) break;        else if (stristr(buff,"_[[완료[[")||strlen(buff1)>99990) {			found=Yes;			strcpy(cid,bbs.id);strcpy(cname,bbs.name);//         if (bbs.num>=0) {printf("%s %s",bbs.id,bbs.title);pressenter();}			bbs_save_add3(0);			clear_bbs();			time(&bbs.date);			text_mode=No;			unlink(TMP_FILE);		}        else if (stristr(buff,"_[[제목[[")) xstrncpy(bbs.title,buff2,60);        else if (stristr(buff,"_[[아이[[")) xstrncpy(bbs.id   ,buff2,8);        else if (stristr(buff,"_[[이름[[")) xstrncpy(bbs.name ,buff2,8);        else if (stristr(buff,"_[[키워[[")) xstrncpy(bbs.key  ,buff2,8);        else if (stristr(buff,"_[[파일[[")) xstrncpy(bbs.filename,buff2,12);        else if (stristr(buff,"_[[파크[[")) bbs.filesize=atoi(buff2);        else if (stristr(buff,"_[[티코[[")) xstrncpy(bbs.tcode,buff2,12);        else if (stristr(buff,"_[[날짜[[")) bbs.date=str2date2(buff2);        else if (stristr(buff,"_[[등록[[")) bbs.date=str2date2(buff2);        else if (stristr(buff,"_[[조날[[")) bbs.date2=str2date2(buff2);        else if (stristr(buff,"_[[번호[[")) bbs.num=atoi(buff2);        else if (stristr(buff,"_[[줄수[[")) bbs.line=atoi(buff2);        else if (stristr(buff,"_[[다운[[")) bbs.down=atoi(buff2);        else if (stristr(buff,"_[[조회[[")) bbs.read=atoi(buff2);        else if (stristr(buff,"_[[라인[[")) bbs.line=atoi(buff2);        else if (stristr(buff,"_[[찬성[[")) bbs.ok=atoi(buff2);        else if (stristr(buff,"_[[추천[[")) bbs.gd=atoi(buff2);        else if (stristr(buff,"_[[내용[[")) {			unlink(TMP_FILE);			text_mode=Yes;		}        else if (text_mode) {            put_line3(buff1,TMP_FILE);        }	}	fclose(fp1);	printf("변환이 끝났습니다.");	pressenter();}xformat2()	//xformat으로 변환{	FILE *fp1,*fp2,*fp3,*fp4;	int i,n=0,n1,n2;	int key=No;	int now_posi,count;	char ch,c;	printf("\n......화일 추출중.............\n");	fflush(NULL);	fp1=fopen(NOW_FILE ,"r");	fp2=fopen(NOW_FILED,"r");	if (fp1==NULL||fp2==NULL) return;	fp3=fopen(TMP_FILE ,"w+");	now_posi=0;	count=0;	while (fread(&bbs,sizeof_bbs,1,fp1)){		if (bbs.del)		continue;		fprintf(fp3,"__[[번호[[%d\n",bbs.num);		fprintf(fp3,"__[[제목[[%s\n",bbs.title);		fprintf(fp3,"__[[아이[[%s\n",bbs.id);		fprintf(fp3,"__[[이름[[%s\n",bbs.name);		fprintf(fp3,"__[[날짜[[%s\n",datestr(8,bbs.date));		fprintf(fp3,"__[[조날[[%s\n",datestr(8,bbs.date2));		fprintf(fp3,"__[[줄수[[%d\n",bbs.line);		if (bbs.read			!=0) fprintf(fp3,"__[[조회[[%d\n",bbs.read);		if (bbs.down			!=0) fprintf(fp3,"__[[다운[[%d\n",bbs.down);        if (bbs.gd              !=0) fprintf(fp3,"__[[추천[[%d\n",bbs.gd);        if (bbs.ok              !=0) {            if (calc_ok(1)>0) fprintf(fp3,"__[[찬성[[%u\n",calc_ok(1));            if (calc_ok(2)>0) fprintf(fp3,"__[[반대[[%u\n",calc_ok(2));            if (calc_ok(3)>0) fprintf(fp3,"__[[응답[[%u\n",calc_ok(3));        }		if (strlen(bbs.filename )>0) fprintf(fp3,"__[[파일[[%s\n",bbs.filename);        if (bbs.filesize        !=0) fprintf(fp3,"__[[파크[[%u\n",bbs.filesize);		if (strlen(bbs.tcode	)>0) fprintf(fp3,"__[[티코[[%s\n",bbs.tcode);		if (strlen(bbs.key		)>0) fprintf(fp3,"__[[키워[[%s\n",bbs.key);        if (bbs.size>0&&bbs.size<1000000) {            fprintf(fp3,"__[[내용[[\n");            ch=0;            fseek(fp2,bbs.posi,SEEK_SET);            for (i=0;i<bbs.size;i++) {                ch=fgetc(fp2);                if (ch==0||ch==-1) break;                fputc(ch,fp3);             //내용에 저장            }            if (ch!='\n') fprintf(fp3,"\n");        }		count++;        fprintf(fp3,"__[[완료[[\n");	}	fclose(fp1);	fclose(fp2);	fclose(fp3);	fflush(NULL);	view_text(TMP_FILE);	unlink(TMP_FILE);}del_enter2(unsigned char *buff){	int i,n;	char buff2[100020];	i=0;	n=0;	while (buff[i]!=0) {		if ( buff[i]!='\n'&&buff[i]!='\r' ) buff2[n++]=buff[i];		i++;	}	if (n>(int)strlen(buff)) n=(int)strlen(buff);	buff2[n]=0;	strcpy(buff,buff2);}put_line3(char *buff,char *filename){	FILE *fp;	if ((fp=fopen(filename,"a+"))==NULL) fp=fopen(filename,"w+");	if (fp!=NULL) {		fprintf(fp,"%s\n",buff);		fclose(fp);	}}